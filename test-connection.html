<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test de Conexi√≥n</title>
    <style>
        body { font-family: Arial, sans-serif; padding: 20px; background: #f5f5f5; }
        .test-item { background: white; margin: 10px 0; padding: 15px; border-radius: 5px; box-shadow: 0 2px 5px rgba(0,0,0,0.1); }
        .success { border-left: 4px solid #4CAF50; }
        .error { border-left: 4px solid #f44336; }
        .loading { border-left: 4px solid #ff9800; }
        button { background: #20B2AA; color: white; border: none; padding: 10px 20px; border-radius: 5px; cursor: pointer; margin: 5px; }
        button:hover { background: #008B8B; }
        .info { background: #e3f2fd; padding: 10px; border-radius: 5px; margin: 10px 0; }
    </style>
</head>
<body>
    <h1>üîß Test de Conexi√≥n API</h1>
    
    <div class="info">
        <strong>Informaci√≥n del dispositivo:</strong><br>
        <span id="device-info"></span>
    </div>
    
    <div class="test-item loading" id="test-results">
        <h3>üîÑ Probando conexiones...</h3>
        <div id="results-content">Haz clic en "Probar Conexiones" para comenzar</div>
    </div>
    
    <button onclick="testConnections()">üîç Probar Conexiones</button>
    <button onclick="location.reload()">üîÑ Recargar</button>
    
    <script>
        // Mostrar informaci√≥n del dispositivo
        document.getElementById('device-info').innerHTML = `
            User Agent: ${navigator.userAgent}<br>
            Es m√≥vil: ${/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)}<br>
            Conexi√≥n: ${navigator.connection ? navigator.connection.effectiveType : 'No disponible'}<br>
            Online: ${navigator.onLine}
        `;
        
        async function testConnections() {
            const resultsDiv = document.getElementById('results-content');
            resultsDiv.innerHTML = '<div style="color: #ff9800;">üîÑ Iniciando pruebas...</div>';
            
            const urls = [
                { url: 'https://93.189.91.62:8443/data', name: 'HTTPS Puerto 8443' },
                { url: 'https://93.189.91.62/data', name: 'HTTPS Puerto 443' },
                { url: 'http://93.189.91.62:8080/data', name: 'HTTP Puerto 8080' }
            ];
            
            let results = [];
            
            for (let i = 0; i < urls.length; i++) {
                const { url, name } = urls[i];
                resultsDiv.innerHTML += `<div style="margin: 5px 0;">üîÑ Probando ${name}...</div>`;
                
                try {
                    const startTime = Date.now();
                    const response = await fetch(url, {
                        method: 'GET',
                        headers: {
                            'Accept': 'application/json'
                        }
                    });
                    const endTime = Date.now();
                    const duration = endTime - startTime;
                    
                    if (response.ok) {
                        const data = await response.json();
                        results.push({
                            name,
                            url,
                            status: 'success',
                            statusCode: response.status,
                            duration: duration + 'ms',
                            dataLength: Array.isArray(data) ? data.length : 'No es array'
                        });
                        resultsDiv.innerHTML += `<div style="color: #4CAF50;">‚úÖ ${name}: OK (${response.status}) - ${duration}ms - ${Array.isArray(data) ? data.length : 'No array'} elementos</div>`;
                    } else {
                        results.push({
                            name,
                            url,
                            status: 'error',
                            statusCode: response.status,
                            duration: duration + 'ms'
                        });
                        resultsDiv.innerHTML += `<div style="color: #f44336;">‚ùå ${name}: Error ${response.status} - ${duration}ms</div>`;
                    }
                } catch (error) {
                    results.push({
                        name,
                        url,
                        status: 'error',
                        error: error.message
                    });
                    resultsDiv.innerHTML += `<div style="color: #f44336;">‚ùå ${name}: ${error.message}</div>`;
                }
            }
            
            // Resumen
            const successCount = results.filter(r => r.status === 'success').length;
            const testItem = document.getElementById('test-results');
            
            if (successCount > 0) {
                testItem.className = 'test-item success';
                testItem.innerHTML = `
                    <h3>‚úÖ Pruebas Completadas</h3>
                    <div>${successCount}/${urls.length} conexiones exitosas</div>
                    <div style="margin-top: 10px;">
                        <strong>Conexiones que funcionan:</strong><br>
                        ${results.filter(r => r.status === 'success').map(r => `‚Ä¢ ${r.name} (${r.statusCode}) - ${r.duration}`).join('<br>')}
                    </div>
                `;
            } else {
                testItem.className = 'test-item error';
                testItem.innerHTML = `
                    <h3>‚ùå Todas las conexiones fallaron</h3>
                    <div>0/${urls.length} conexiones exitosas</div>
                    <div style="margin-top: 10px;">
                        <strong>Errores encontrados:</strong><br>
                        ${results.map(r => `‚Ä¢ ${r.name}: ${r.error || r.statusCode}`).join('<br>')}
                    </div>
                `;
            }
        }
    </script>
</body>
</html>
