<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="Content-Security-Policy"
    content="default-src 'self' 'unsafe-inline' 'unsafe-eval' data: blob: https: wss:;
    script-src 'self' 'unsafe-inline' 'unsafe-eval' https://maps.googleapis.com https://maps.gstatic.com;
    style-src 'self' 'unsafe-inline' https: https://fonts.googleapis.com;
    font-src 'self' https: https://fonts.gstatic.com;
    img-src 'self' data: https: blob:;
    connect-src 'self' https: wss:;
    frame-src 'self' https:;
    object-src 'none';">
    
    <title>Mediterranean Blue International LLC | Realty</title>
    <style>
        :root {
            /* Elegant Turquoise Palette */
            --primary-turquoise: #20B2AA;
            --dark-turquoise: #008B8B;
            --light-turquoise: #E0FFFF;
            --soft-turquoise: #B0E0E6;
            --pale-turquoise: #F0FFFF;
            --medium-turquoise: #48CAE4;
            --deep-turquoise: #007F7F;
            
            /* Complementary Colors */
            --white: #FFFFFF;
            --cream: #FDFDFD;
            --light-gray: #F8F9FA;
            --medium-gray: #E9ECEF;
            --text-gray: #495057;
            --dark-gray: #212529;
            --charcoal: #343A40;
            
            /* Accent Colors */
            --gold-accent: #D4AF37;
            --silver-accent: #C0C0C0;
            --pearl-accent: #F8F8FF;
            
            /* Background Gradients */
            --header-bg: #BDEFFF;
            --body-bg: linear-gradient(180deg, var(--pale-turquoise) 0%, var(--light-turquoise) 100%);
            --card-bg: var(--white);
            --hover-bg: var(--light-gray);
            
            /* Logo Accent */
            --logo-accent: var(--primary-turquoise);
            /* Additional variables to match home */
            --ink: var(--dark-turquoise);
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Arial', 'Segoe UI Emoji', 'Apple Color Emoji', 'Noto Color Emoji', sans-serif;
        }
        
        body {
            background: var(--body-bg);
            color: var(--text-gray);
            line-height: 1.7;
            min-height: 100vh;
            min-height: 100dvh;
            font-weight: 400;
        }
        
        header {
            display: flex;
            flex-direction: row;
            align-items: center;
            justify-content: space-between;
            padding: 15px 20px;
            background: #fff !important; /* fondo blanco */
            box-shadow: none;
            border-bottom: none;
            position: relative;
            z-index: 100;
            max-height: 230px; /* Altura para logo de 200px + padding */
            overflow: visible;
        }
        
        .header-content {
            display: flex;
            flex-direction: row;
            align-items: center;
            justify-content: space-between;
            width: 100%;
            max-width: none;
        }
        
        .logo-section {
            display: flex;
            flex-direction: column;
            align-items: flex-start;
            justify-content: flex-start;
            margin-bottom: 0;
            width: auto;
            height: 200px;
            overflow: hidden;
        }
        
        .logo-section img {
            max-height: 450px;
            height: auto;
            width: auto;
            display: block;
            transform: translateY(5px);
        }
        
        .logo-graphic {
            position: relative;
            width: 100%;
            max-width: 400px;
            height: 120px;
            background: transparent; /* igual que header para que no se note */
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0;
            border-radius: 0;
            box-shadow: none;
            overflow: hidden;
            padding: 10px;
        }
        
        .semicircle {
            position: absolute;
            bottom: 40px;
            left: 0;
            width: 100px;
            height: 100px;
           border: 5px solid var(--logo-accent); /* Color y grosor del borde */
            border-radius: 50%; /* C√≠rculo completo */
        background: transparent;
            z-index: 1;
        }
        /* L√≠nea recta debajo del semicirculo */
        .semicircle-underline {
            position: absolute;
            bottom: 24px; /* un poco m√°s cerca de la l√≠nea superior */
            left: 8px; /* inicia ligeramente dentro del arco */
            width: 85px; /* un poco m√°s corta que el semicirculo */
            height: 5px;
            background-color: var(--logo-accent);
            border-radius: 4px;
            z-index: 1;
        }
        
        .horizon-line {
            position: absolute;
            bottom: 40px;
            left: 0; /* se extiende por debajo del arco hasta el otro extremo */
            width: 100%;
            height: 5px; /* mismo grosor que el borde del semicirculo */
            background-color: var(--logo-accent); /* mismo color que el semicirculo */
            border-top-left-radius: 100px;
            border-top-right-radius: 100px;
            z-index: 1;
        }
        
       
        
        .logo-text { 
            position: relative; 
            z-index: 2;
            margin-left: 0px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            height: 100%;
            align-items: center;
            text-align: center;
        }
        
        .logo-main {
            font-size: 1.1em;
            font-weight: 700;
            color: var(--dark-turquoise);
            text-shadow: 0 2px 4px rgba(255, 255, 255, 0.8);
            letter-spacing: -0.5px;
            line-height: 1.2;
        }
        
        
        
        .nav-section {
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
            justify-content: center;
            width: 100%;
            padding: 10px 15px;
            background: transparent;
            border: none !important;
            border-radius: 0;
            box-shadow: none;
        }
        
        .nav-item {
            font-weight: 600;
            cursor: pointer;
            color: var(--dark-turquoise);
            transition: all 0.4s ease;
            text-transform: uppercase;
            font-size: 0.85em;
            letter-spacing: 1.2px;
            padding: 10px 18px;
            position: relative;
            text-decoration: none;
            border-radius: 8px;
            background: var(--white);
            box-shadow: 0 2px 8px rgba(32, 178, 170, 0.2);
            border: 2px solid var(--primary-turquoise);
        }
        
        .nav-item:hover {
            color: var(--white);
            background: linear-gradient(135deg, var(--primary-turquoise) 0%, var(--dark-turquoise) 100%);
            transform: translateY(-3px);
            box-shadow: 0 6px 20px rgba(32, 178, 170, 0.4);
            border-color: var(--dark-turquoise);
        }
        
        .nav-item.active {
            background: linear-gradient(135deg, var(--primary-turquoise) 0%, var(--dark-turquoise) 100%);
            color: var(--white);
            box-shadow: 0 4px 12px rgba(32, 178, 170, 0.3);
        }
        
        /* Layout principal con panel de filtros */
        .main-layout {
            display: flex;
            gap: 0;
            max-width: none;
            margin: 0;
            padding: 0;
            min-height: calc(100vh - 120px); /* fallback */
            min-height: calc(100dvh - 120px); /* Altura completa menos header */
        }
        
        .filters-panel {
            width: 300px;
            min-width: 300px;
            background: var(--white);
            border-radius: 0;
            box-shadow: 2px 0 10px rgba(32, 178, 170, 0.1);
            padding: 20px;
            height: calc(100vh - 140px); /* fallback */
            height: calc(100dvh - 140px); /* Altura completa menos header y padding */
            overflow-y: auto;
            position: fixed;
            top: 110px; /* subimos el panel un poco */
            left: 0;
            z-index: 10;
            border-right: 2px solid var(--light-turquoise);
            transition: none; /* Sin transici√≥n para movimiento din√°mico */
        }
        
        /* Clase para cuando el panel debe subir al hacer scroll */
        .filters-panel.scrolled {
            top: 0; /* Sube hasta arriba cuando el header se oculta */
            height: 100vh; /* fallback */
            height: 100dvh; /* Ocupa toda la altura de la pantalla */
        }
        
        .filters-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 2px solid var(--light-turquoise);
        }
        
        .toggle-filters-btn {
            display: none;
            background: none;
            border: none;
            color: var(--dark-turquoise);
            font-size: 1.2em;
            cursor: pointer;
            padding: 5px;
            border-radius: 4px;
            transition: all 0.3s ease;
        }
        
        .toggle-filters-btn:hover {
            background: var(--light-turquoise);
        }
        
        .filters-content {
            transition: all 0.3s ease;
        }
        
        .content-area {
            flex: 1;
            min-width: 0;
            margin-left: 300px; /* Espacio para el sidebar fijo */
            padding: 12px;
            padding-top: 6px; /* subir un poco el contenido bajo la cabecera */
        }
        
        .property-container {
            max-width: none;
            margin: 0;
            padding: 0;
        }
        
        /* Estilos para las secciones de filtros */
        .filter-section {
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 1px solid var(--light-gray);
        }
        
        .filter-section:last-of-type {
            border-bottom: none;
            margin-bottom: 0;
        }
        
        .filter-section h3 {
            font-size: 1em;
            font-weight: 700;
            color: var(--dark-turquoise);
            margin-bottom: 8px;
        }
        .range-row { display: grid; grid-template-columns: 1fr 1fr; gap: 8px; }
        .range-row input { width: 100%; padding: 8px 10px; border: 2px solid var(--light-gray); border-radius: 6px; font-size: 0.9em; }
        .range-row input:focus { outline: none; border-color: var(--primary-turquoise); box-shadow: 0 0 0 3px rgba(32, 178, 170, 0.1); }
        .select-field { width: 100%; padding: 8px 12px; border: 2px solid var(--light-gray); border-radius: 6px; font-size: 0.9em; background: var(--white); }
        
        /* B√∫squeda de ubicaci√≥n */
        .search-container {
            position: relative;
        }
        
        #location-search {
            width: 100%;
            padding: 8px 12px;
            border: 2px solid var(--light-gray);
            border-radius: 6px;
            font-size: 0.9em;
            transition: all 0.3s ease;
            background: var(--white);
        }
        
        #location-search:focus {
            outline: none;
            border-color: var(--primary-turquoise);
            box-shadow: 0 0 0 3px rgba(32, 178, 170, 0.1);
        }
        
        .suggestions-dropdown {
            position: absolute;
            top: 100%;
            left: 0;
            right: 0;
            background: var(--white);
            border: 1px solid var(--light-gray);
            border-top: none;
            border-radius: 0 0 8px 8px;
            max-height: 200px;
            overflow-y: auto;
            z-index: 1000;
            display: none;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        }
        
        .suggestion-item {
            padding: 12px 15px;
            cursor: pointer;
            border-bottom: 1px solid var(--light-gray);
            transition: background-color 0.2s ease;
            font-size: 0.9em;
        }
        
        .suggestion-item:hover {
            background: var(--light-turquoise);
        }
        
        .suggestion-item:last-child {
            border-bottom: none;
        }
        
        /* Contenedor de requisitos */
        .requirements-container {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }
        
        
        
        
        /* Botones de acci√≥n */
        .filter-actions {
            display: flex;
            gap: 12px;
            margin-top: 25px;
        }
        
        .apply-filters-btn, .clear-filters-btn {
            flex: 1;
            padding: 12px 18px;
            border: none;
            border-radius: 6px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 0.85em;
        }
        
        .apply-filters-btn {
            background: linear-gradient(135deg, var(--primary-turquoise) 0%, var(--dark-turquoise) 100%);
            color: var(--white);
        }
        
        .apply-filters-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(32, 178, 170, 0.3);
        }
        
        .clear-filters-btn {
            background: var(--white);
            color: var(--text-gray);
            border: 2px solid var(--light-gray);
        }
        
        .clear-filters-btn:hover {
            background: var(--light-gray);
            border-color: var(--medium-gray);
        }
        
        .property-card {
            background-color: var(--card-bg);
            border-radius: 12px;
            box-shadow: 0 4px 25px rgba(32, 178, 170, 0.08);
            margin-bottom: 30px;
            overflow: hidden;
            display: flex;
            flex-direction: column;
            transition: all 0.4s ease;
            border: 1px solid var(--light-gray);
            position: relative;
        }

        /* Marca de agua MBIR grande desde el precio hasta la ubicaci√≥n */
        .property-card::before {
            content: '';
            position: absolute;
            top: 28px; /* Altura aproximada donde empieza el t√≠tulo/ubicaci√≥n */
            left: 50%; /* Comienza desde la mitad del contenedor */
            right: 0;
            height: 200px; /* Altura espec√≠fica desde ubicaci√≥n hasta precio */
            background-image: url('data:image/svg+xml;charset=utf-8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 600 300"><g transform="rotate(305 300 150)" opacity="0.3"><g fill="none" stroke="%2320B2AA" stroke-width="6"><path d="M100 200 Q150 150 200 200" fill="none"/><rect x="108" y="184" width="85" height="6" rx="4" fill="%2320B2AA"/><rect x="100" y="200" width="250" height="6" rx="100" fill="%2320B2AA"/></g><text x="210" y="195" font-family="Arial" font-size="32" font-weight="900" fill="%23003366" letter-spacing="3px">MBI</text></g></svg>');
            background-repeat: no-repeat;
            background-position: center;
            background-size: 400px auto;
            pointer-events: none;
            z-index: 0.5; /* Entre el fondo y el precio */
        }

        .property-card > * {
            position: relative;
            z-index: 2;
        }

        /* Asegurar que el texto importante est√© por encima de la marca de agua */
        .property-title,
        .property-location,
        .property-description,
        .property-features,
        .property-details,
        .view-details {
            position: relative;
            z-index: 3;
        }
        
        .property-card:hover {
            transform: translateY(-8px);
            box-shadow: 0 8px 35px rgba(32, 178, 170, 0.15);
            border-color: var(--primary-turquoise);
        }
        
        .property-image-container {
            position: relative;
            height: 250px;
        }
        
        .property-details-container {
            padding: 28px; /* m√°s aire para evitar tocar bordes */
        }
        .property-details-container * { max-width: 100%; }
        
        .image-carousel {
            position: relative;
            height: 100%;
            overflow: hidden;
            background: linear-gradient(135deg, var(--light-turquoise) 0%, var(--white) 100%);
        }
        
        .carousel-image {
            width: 100%;
            height: 100%;
            object-fit: cover;
            position: absolute;
            top: 0;
            left: 0;
            opacity: 0;
            transition: opacity 0.5s ease;
        }
        
        .carousel-image.active {
            opacity: 1;
        }
        
        .carousel-nav {
            position: absolute;
            top: 50%;
            width: 100%;
            display: flex;
            justify-content: space-between;
            transform: translateY(-50%);
            padding: 0 10px;
            z-index: 10;
        }
        
        .carousel-btn {
            background: rgba(32, 178, 170, 0.9);
            color: white;
            border: none;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            font-size: 1.1em;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            backdrop-filter: blur(5px);
            box-shadow: 0 2px 10px rgba(32, 178, 170, 0.3);
        }
        
        .carousel-btn:hover {
            background: var(--primary-turquoise);
            transform: scale(1.15);
            box-shadow: 0 4px 15px rgba(32, 178, 170, 0.4);
        }
        
        .carousel-indicators {
            position: absolute;
            bottom: 15px;
            left: 0;
            right: 0;
            display: flex;
            justify-content: center;
            gap: 8px;
            z-index: 10;
        }
        
        .indicator {
            width: 10px;
            height: 10px;
            border-radius: 50%;
            background-color: rgba(255, 255, 255, 0.5);
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .indicator.active {
            background-color: var(--white);
            transform: scale(1.2);
        }
        
        .property-title {
            font-size: 1.6em;
            margin-bottom: 12px;
            color: var(--dark-turquoise);
            font-weight: 700;
            line-height: 1.3;
            letter-spacing: -0.5px;
        }
        
        .property-location {
            font-size: 1em;
            color: var(--text-gray);
            margin-bottom: 15px;
            font-weight: normal;
            display: flex;
            align-items: center;
        }
        
        .property-location:before {
            content: 'üìç';
            margin-right: 8px;
            font-size: 0.9em;
        }
        
        .property-description {
            margin: 12px 0 16px 0;
            line-height: 1.7;
            color: var(--text-gray);
            font-size: 1.05em;
            font-weight: 500;
            letter-spacing: -0.1px;
            overflow-wrap: anywhere; /* evita overflow en palabras largas */
            word-break: break-word;
            hyphens: auto;
        }
        
        .property-features {
            margin-bottom: 20px;
            padding-left: 15px;
        }
        
        .property-features li {
            margin-bottom: 10px;
            list-style-type: none;
            position: relative;
            padding-left: 20px;
            color: var(--dark-gray);
            line-height: 1.4;
            font-size: 0.9em;
        }
        
        .property-features li:before {
            content: '‚Ä¢';
            position: absolute;
            left: 0;
            color: var(--primary-blue);
            font-size: 1.5em;
            line-height: 0;
        }
        
        .property-price {
            font-size: 2em;
            font-weight: 800;
            margin-bottom: 20px;
            color: var(--primary-turquoise);
            display: flex;
            align-items: center;
            text-shadow: 0 1px 2px rgba(32, 178, 170, 0.1);
            position: relative;
            z-index: 0; /* Menor que la marca de agua para que no la tape */
            background: rgba(255, 255, 255, 0.7); /* Fondo semi-transparente para legibilidad */
            padding: 5px 10px;
            border-radius: 8px;
        }
        
        .property-price:before {
            content: '‚Ç¨';
            font-size: 0.8em;
            margin-right: 5px;
        }
        
        /* Property Detail Page Styles */
        .property-detail-container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }
        
        .back-button {
            display: inline-block;
            margin-bottom: 20px;
            padding: 10px 20px;
            background: var(--primary-turquoise);
            color: white;
            text-decoration: none;
            border-radius: 5px;
            font-weight: 600;
            transition: background 0.3s ease;
        }
        
        .back-button:hover {
            background: var(--dark-turquoise);
        }
        
        .property-detail-card {
            background: white;
            border-radius: 12px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.1);
            overflow: hidden;
        }
        
        .detail-media {
            position: relative;
        }
        
        .detail-hero {
            position: relative;
            height: 400px;
            overflow: hidden;
        }
        
        .property-detail-image {
            width: 100%;
            height: 100%;
            object-fit: cover;
            display: none;
        }
        
        .property-detail-image.active {
            display: block;
        }
        
        .detail-ctrl {
            position: absolute;
            top: 50%;
            transform: translateY(-50%);
            background: rgba(0,0,0,0.5);
            color: white;
            border: none;
            padding: 15px 20px;
            font-size: 24px;
            cursor: pointer;
            border-radius: 5px;
        }
        
        .detail-ctrl.prev {
            left: 20px;
        }
        
        .detail-ctrl.next {
            right: 20px;
        }
        
        .detail-thumbs {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px 20px;
            background: #f8f9fa;
        }
        
        .thumb-strip {
            display: flex;
            gap: 10px;
        }
        
        .thumb {
            width: 60px;
            height: 60px;
            border-radius: 5px;
            overflow: hidden;
            cursor: pointer;
            border: 2px solid transparent;
            transition: border-color 0.3s ease;
        }
        
        .thumb.active {
            border-color: var(--primary-turquoise);
        }
        
        .thumb img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }
        
        .thumb-count {
            color: var(--text-gray);
            font-size: 14px;
        }
        
        .property-detail-info {
            padding: 30px;
        }
        
        .property-detail-title {
            font-size: 2.5em;
            color: var(--dark-turquoise);
            margin-bottom: 10px;
        }
        
        .property-location {
            color: var(--text-gray);
            font-size: 1.2em;
            margin-bottom: 20px;
        }
        
        .property-detail-description {
            font-size: 1.1em;
            line-height: 1.6;
            color: var(--text-gray);
            margin-bottom: 30px;
        }
        
        .property-detail-price {
            font-size: 2em;
            font-weight: 700;
            color: var(--primary-turquoise);
        }
        
        .overview-section {
            margin-top: 30px;
            padding-top: 30px;
            border-top: 1px solid var(--medium-gray);
        }
        
        .overview-title {
            font-size: 1.5em;
            font-weight: 700;
            color: var(--dark-turquoise);
            margin-bottom: 20px;
        }
        
        .overview-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
        }
        
        .overview-group h4 {
            color: var(--dark-turquoise);
            margin-bottom: 15px;
            font-size: 1.2em;
        }
        
        .overview-row {
            display: flex;
            justify-content: space-between;
            padding: 8px 0;
            border-bottom: 1px solid #f0f0f0;
        }
        
        .overview-key {
            color: var(--text-gray);
        }
        
        .overview-val {
            font-weight: 600;
            color: var(--dark-turquoise);
        }
        
        .no-image {
            background: #f8f9fa;
            color: var(--text-gray);
            font-size: 1.2em;
        }
        
        /* Responsive styles for property details */
        @media (max-width: 767px) {
            .property-detail-container {
                padding: 10px;
            }
            
            .property-detail-title {
                font-size: 1.8em;
            }
            
            .detail-hero {
                height: 250px;
            }
            
            .detail-ctrl {
                padding: 10px 15px;
                font-size: 18px;
            }
            
            .detail-ctrl.prev {
                left: 10px;
            }
            
            .detail-ctrl.next {
                right: 10px;
            }
            
            .thumb {
                width: 40px;
                height: 40px;
            }
            
            .property-detail-info {
                padding: 20px;
            }
            
            .overview-grid {
                grid-template-columns: 1fr;
            }
        }

        .property-details {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            flex-wrap: wrap;
            font-size: 0.8em;
        }
        
        .detail-item {
            font-weight: 600;
            color: var(--dark-turquoise);
            background: linear-gradient(135deg, var(--light-turquoise) 0%, var(--soft-turquoise) 100%);
            padding: 8px 16px;
            border-radius: 25px;
            display: flex;
            align-items: center;
            transition: all 0.3s ease;
            border: 1px solid var(--medium-turquoise);
            font-size: 0.85em;
        }
        
        .detail-item:hover {
            background: linear-gradient(135deg, var(--primary-turquoise) 0%, var(--medium-turquoise) 100%);
            color: var(--white);
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(32, 178, 170, 0.3);
        }
        
        .view-details {
            display: inline-block;
            text-align: center;
            padding: 12px 24px;
            background: linear-gradient(135deg, var(--primary-turquoise) 0%, var(--dark-turquoise) 100%);
            color: var(--white);
            text-decoration: none;
            font-weight: 700;
            transition: all 0.4s ease;
            text-transform: uppercase;
            letter-spacing: 1.2px;
            font-size: 0.85em;
            border-radius: 8px;
            width: 100%;
            box-sizing: border-box;
            box-shadow: 0 3px 15px rgba(32, 178, 170, 0.2);
            border: none;
        }
        
        .view-details:hover {
            background: linear-gradient(135deg, var(--dark-turquoise) 0%, var(--deep-turquoise) 100%);
            transform: translateY(-3px);
            box-shadow: 0 6px 20px rgba(32, 178, 170, 0.3);
            letter-spacing: 1.5px;
        }
        .bottom-row { display: flex; gap: 12px; align-items: center; justify-content: space-between; margin-top: 12px; }
        .bottom-row .property-price { margin: 0; }
        
        .loading {
            text-align: center;
            padding: 40px;
            font-size: 1em;
            color: var(--text-gray);
        }
        
        .pagination {
            display: flex;
            justify-content: center;
            margin: 24px 0;
            gap: 10px;
            flex-wrap: wrap;
        }
        
        .page-btn {
            padding: 8px 16px;
            background: transparent;
            color: var(--dark-turquoise);
            border: 1px solid rgba(0,0,0,0.06);
            border-radius: 24px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: 700;
            font-size: 0.9em;
            box-shadow: 0 1px 3px rgba(32, 178, 170, 0.08);
            backdrop-filter: saturate(120%);
        }
        
        .page-btn:hover {
            color: var(--white);
            background: linear-gradient(135deg, var(--primary-turquoise) 0%, var(--medium-turquoise) 100%);
            border-color: transparent;
            box-shadow: 0 4px 12px rgba(32, 178, 170, 0.25);
            transform: translateY(-1px);
        }
        
        .page-btn.active {
            background: linear-gradient(135deg, var(--primary-turquoise) 0%, var(--dark-turquoise) 100%);
            color: var(--white);
            border-color: transparent;
            box-shadow: 0 4px 12px rgba(32, 178, 170, 0.25);
        }
        
        .page-btn.disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }
        
        footer {
            background-color: #1a1a2e;
            color: var(--white);
            padding: 20px 0;
            text-align: center;
            margin-top: 40px;
            font-size: 0.8em;
        }
        
        /* Legal Modal */
        .legal-modal-backdrop {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.7);
            z-index: 2000;
            display: none;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }
        
        .legal-modal-backdrop[aria-hidden="false"] {
            display: flex;
        }
        
        .legal-modal {
            background: var(--white);
            border-radius: 12px;
            max-width: 600px;
            width: 100%;
            max-height: 80vh;
            overflow-y: auto;
            position: relative;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
        }
        
        .legal-close {
            position: absolute;
            top: 15px;
            right: 20px;
            background: none;
            border: none;
            font-size: 24px;
            cursor: pointer;
            color: var(--text-gray);
            z-index: 10;
        }
        
        .legal-title {
            font-size: 1.5em;
            color: var(--dark-turquoise);
            margin: 20px 20px 15px 20px;
            padding-right: 40px;
        }
        
        .legal-tabs {
            display: flex;
            border-bottom: 1px solid var(--medium-gray);
            margin: 0 20px;
        }
        
        .legal-tab {
            background: none;
            border: none;
            padding: 12px 20px;
            cursor: pointer;
            color: var(--text-gray);
            border-bottom: 2px solid transparent;
            transition: all 0.3s;
        }
        
        .legal-tab.active {
            color: var(--dark-turquoise);
            border-bottom-color: var(--dark-turquoise);
        }
        
        .legal-content {
            padding: 20px;
        }
        
        .legal-section h3 {
            color: var(--dark-turquoise);
            margin-bottom: 15px;
            font-size: 1.2em;
        }
        
        .legal-section p {
            margin-bottom: 15px;
            line-height: 1.6;
            color: var(--text-gray);
        }
        

        /* Mobile adjustments */
        @media (max-width: 767px) {
            /* Ocultar SVG de banderas en m√≥viles */
            .lang-btn::before,
            .lang-option::before {
                display: none !important;
            }
            
            .main-layout {
                flex-direction: column;
                gap: 0;
                margin: 0;
                padding: 0;
                min-height: auto; /* No reservar altura en m√≥vil */
            }
            
            .filters-panel {
                width: 100%;
                position: static;
                order: 1; /* Primero, despu√©s del header */
                background: transparent;
                padding: 0;
                margin: 0;
                z-index: 10;
                display: block; /* Siempre visible */
                height: auto !important; /* Anula alturas fijas de desktop */
            }
            
            .filters-header {
                background: var(--white);
                color: var(--dark-turquoise);
                padding: 15px 20px;
                margin: 0;
                border-radius: 0;
                cursor: pointer;
                display: flex;
                justify-content: space-between;
                align-items: center;
               
            }
            
            .filters-header h2 {
                margin: 0;
                color: var(--dark-turquoise);
                font-size: 1.1em;
                font-weight: 600;
            }
            
            .toggle-filters-btn {
                display: block;
                background: none;
                border: none;
                color: var(--dark-turquoise);
                font-size: 18px;
                cursor: pointer;
                padding: 5px;
            }
            
            .filters-content {
                background: var(--white);
                border-radius: 0 0 12px 12px;
                
                max-height: 0;
                overflow: hidden;
                padding: 0 20px;
                display: none;
                border-top: 1px solid var(--light-turquoise);
                transition: max-height 0.4s ease, padding 0.4s ease;
            }
            
            .filters-content.show {
                display: block;
                max-height: 1000px; /* Altura suficiente para el contenido */
                padding: 20px;
            }
            
            .content-area {
                order: 2;
                margin-left: 0;
                padding: 0;
                transition: transform 0.4s ease; /* Transici√≥n suave para el desplazamiento */
            }
            
            .filter-section {
                margin-bottom: 12px;
                padding-bottom: 10px;
            }
            
            /* Ajustar el espaciado de las casas individuales */
            .property-card {
                margin: 10px;
                margin-bottom: 20px;
            }
            
            /* Sin espaciado superior - las casas van pegadas al header de filtros */
            .content-area .property-card:first-child {
                margin-top: 0;
            }
            
            .filter-section h3 {
                font-size: 0.95em;
                margin-bottom: 6px;
            }
            
            .range-row {
                gap: 6px;
            }
            
            .range-row input, .select-field, #location-search {
                padding: 6px 10px;
                font-size: 0.85em;
            }
            
            
            .filter-actions {
                flex-direction: row;
                gap: 10px;
                margin-top: 20px;
            }
        }
        
        /* M√≥vil en horizontal - filtros sticky debajo del header */
        @media (max-width: 1024px) and (orientation: landscape) {
            html, body {
                text-align: left !important;
                margin: 0 !important;
                padding: 0 !important;
                width: 100% !important;
                overflow-x: hidden !important;
            }
            
            #app-content {
                margin: 0 !important;
                padding: 0 !important;
                width: 100% !important;
                max-width: 100% !important;
                position: relative !important;
                left: 0 !important;
                right: 0 !important;
                transform: translateX(0) !important;
            }
            
            .main-layout {
                display: flex !important;
                flex-direction: column !important;
                margin: 0 !important;
                margin-left: 0 !important;
                padding: 0 !important;
                align-items: flex-start !important;
                justify-content: flex-start !important;
                width: 100% !important;
                max-width: 100% !important;
                position: relative !important;
                left: 0 !important;
                right: 0 !important;
                /* Asegurar que el sticky funcione correctamente */
                overflow: visible !important;
                overflow-x: visible !important;
                overflow-y: visible !important;
            }
            
            header {
                position: relative !important;
                z-index: 1001 !important;
            }
            
            /* Anular estilos de desktop del panel de filtros */
            .filters-panel {
                position: -webkit-sticky !important;
                position: sticky !important;
                top: 0 !important;
                left: 0 !important;
                right: 0 !important;
                width: 100% !important;
                min-width: 0 !important;
                max-width: 100% !important;
                height: auto !important;
                min-height: auto !important;
                max-height: none !important;
                z-index: 1000 !important;
                border-right: none !important;
                border-bottom: 2px solid var(--light-turquoise);
                box-shadow: 0 2px 10px rgba(32, 178, 170, 0.2);
                order: 1 !important;
                margin: 0 !important;
                margin-left: 0 !important;
                margin-right: 0 !important;
                padding: 0 !important;
                background: var(--white) !important;
                transform: none !important;
                /* Asegurar que se mantenga visible al hacer scroll */
                will-change: transform;
                /* Asegurar que no tape el contenido por los lados */
                overflow: visible !important;
                /* Asegurar que no ocupe espacio horizontal adicional */
                box-sizing: border-box !important;
            }
            
            /* Anular el estilo scrolled en m√≥vil horizontal */
            .filters-panel.scrolled {
                top: 0 !important;
                height: auto !important;
                position: sticky !important;
            }
            
            /* Forzar que los estilos inline de JavaScript no interfieran */
            .filters-panel[style] {
                position: sticky !important;
                top: 0 !important;
                height: auto !important;
            }
            
            .filters-header {
                position: relative !important;
                background: var(--white) !important;
                z-index: 1001;
                padding: 8px 15px;
                margin: 0;
                border-bottom: 2px solid var(--light-turquoise);
                box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
                width: 100%;
                display: flex;
                justify-content: space-between;
                align-items: center;
            }
            
            .filters-content {
                background: var(--white) !important;
                max-height: 0;
                overflow: hidden;
                padding: 0 15px;
                display: none;
                transition: max-height 0.4s ease, padding 0.4s ease;
                width: 100%;
            }
            
            .filters-content.show {
                display: block !important;
                max-height: 35vh;
                padding: 12px 15px;
                overflow-y: auto;
            }
            
            .toggle-filters-btn {
                display: block !important;
            }
            
            .content-area {
                margin: 0 !important;
                margin-left: 0 !important;
                margin-top: 0 !important;
                margin-right: 0 !important;
                margin-bottom: 0 !important;
                padding: 8px !important;
                padding-left: 8px !important;
                padding-right: 8px !important;
                padding-top: 8px !important;
                padding-bottom: 8px !important;
                order: 2 !important;
                flex: 1 !important;
                overflow-y: auto !important;
                width: 100% !important;
                max-width: 100% !important;
                /* Asegurar que no haya espacio reservado para el sidebar de desktop */
                position: relative !important;
                left: 0 !important;
                right: 0 !important;
                /* Eliminar cualquier transformaci√≥n o desplazamiento */
                transform: translateX(0) !important;
                /* Asegurar que est√© por encima de elementos que puedan taparlo */
                z-index: 1 !important;
            }
            
            /* Asegurar que ning√∫n hijo de content-area tenga padding o margin izquierdo */
            .content-area > * {
                margin-left: 0 !important;
                padding-left: 0 !important;
            }
            
            /* Forzar que los estilos inline y de otras media queries no interfieran */
            .content-area[style] {
                margin-left: 0 !important;
                transform: translateX(0) !important;
            }
            
            .property-container {
                margin: 0 !important;
                margin-left: 0 !important;
                margin-right: 0 !important;
                padding: 0 !important;
                padding-left: 0 !important;
                padding-right: 0 !important;
                max-width: 100% !important;
                width: 100% !important;
                text-align: left !important;
                position: relative !important;
                left: 0 !important;
                right: 0 !important;
                transform: translateX(0) !important;
                z-index: 2 !important;
            }
            
            /* Propiedades en horizontal - una columna al borde izquierdo */
            #properties-container {
                display: flex !important;
                flex-direction: column !important;
                gap: 10px !important;
                padding: 0 !important;
                padding-left: 0 !important;
                padding-right: 0 !important;
                margin: 0 !important;
                margin-left: 0 !important;
                margin-right: 0 !important;
                width: 100% !important;
                max-width: 100% !important;
                align-items: flex-start !important;
                justify-content: flex-start !important;
                text-align: left !important;
                position: relative !important;
                left: 0 !important;
                right: 0 !important;
                transform: translateX(0) !important;
                z-index: 2 !important;
            }
            
            .property-card {
                margin: 0 !important;
                margin-left: 0 !important;
                margin-right: 0 !important;
                margin-top: 0 !important;
                margin-bottom: 10px !important;
                padding: 0 !important;
                padding-left: 0 !important;
                padding-right: 0 !important;
                display: flex !important;
                flex-direction: row !important;
                width: 100% !important;
                max-width: 100% !important;
                align-self: flex-start !important;
                text-align: left !important;
                position: relative !important;
                left: 0 !important;
                border-radius: 8px !important;
                overflow: hidden !important;
            }
            
            .property-image-container {
                height: auto !important;
                min-height: 150px !important;
                width: 40% !important;
                max-width: 40% !important;
                flex-shrink: 0 !important;
                margin: 0 !important;
                padding: 0 !important;
            }
            
            .property-details-container {
                padding: 10px 12px !important;
                padding-left: 12px !important;
                padding-right: 12px !important;
                margin-left: 0 !important;
                margin-right: 0 !important;
                flex: 1 !important;
                display: flex !important;
                flex-direction: column !important;
                width: 60% !important;
                margin: 0 !important;
                justify-content: space-between !important;
            }
            
            /* Forzar que todo est√© al borde izquierdo */
            * {
                box-sizing: border-box !important;
            }
            
            .content-area * {
                margin-left: 0 !important;
            }
            
            .content-area > * {
                margin-left: 0 !important;
                padding-left: 0 !important;
            }
            
            /* Asegurar que property-container no tenga ning√∫n desplazamiento */
            .content-area .property-container,
            .content-area .property-container#properties-container {
                margin: 0 !important;
                margin-left: 0 !important;
                margin-right: 0 !important;
                padding: 0 !important;
                padding-left: 0 !important;
                padding-right: 0 !important;
                width: 100% !important;
                max-width: 100% !important;
                position: relative !important;
                left: 0 !important;
                right: 0 !important;
                transform: translateX(0) !important;
            }
            
            /* Asegurar que properties-container est√© al borde izquierdo */
            .content-area #properties-container,
            .property-container#properties-container {
                margin: 0 !important;
                margin-left: 0 !important;
                margin-right: 0 !important;
                padding: 0 !important;
                padding-left: 0 !important;
                padding-right: 0 !important;
                width: 100% !important;
                max-width: 100% !important;
                position: relative !important;
                left: 0 !important;
                right: 0 !important;
                transform: translateX(0) !important;
            }
            
            /* Forzar que las propiedades se muestren completas desde el borde izquierdo */
            .content-area .property-container .property-card,
            #properties-container .property-card {
                margin-left: 0 !important;
                padding-left: 0 !important;
                width: 100% !important;
                max-width: 100% !important;
            }
            
            /* Reducir botones de navegaci√≥n (pesta√±as) un 10% en horizontal */
            .nav-item {
                padding: 9px 16.2px !important;
                font-size: 0.765em !important;
                letter-spacing: 1.08px !important;
                border-radius: 7.2px !important;
            }
            
            .nav-section {
                gap: 13.5px !important;
                padding: 9px 13.5px !important;
                flex-wrap: nowrap !important;
                align-items: center !important;
                justify-content: flex-start !important;
            }
            
            /* Asegurar que el selector de idiomas est√© alineado */
            .lang-selector {
                margin-left: auto !important;
                margin-right: 10px !important;
                align-self: center !important;
            }
            
            .lang-btn {
                display: inline-flex !important;
                align-items: center !important;
            }
            
            .property-title {
                font-size: 1em !important;
                margin-bottom: 4px !important;
                line-height: 1.2 !important;
            }
            
            .property-location {
                font-size: 0.8em !important;
                margin-bottom: 6px !important;
            }
            
            .property-description {
                font-size: 0.75em !important;
                line-height: 1.3 !important;
                margin-bottom: 6px !important;
                flex: 1;
                display: -webkit-box !important;
                -webkit-line-clamp: 3 !important;
                line-clamp: 3 !important;
                -webkit-box-orient: vertical !important;
                overflow: hidden !important;
            }
            
            .property-details {
                font-size: 0.7em !important;
                gap: 4px !important;
                margin-bottom: 6px !important;
                flex-wrap: wrap !important;
            }
            
            .property-price {
                font-size: 1em !important;
                margin-bottom: 4px !important;
            }
            
            .view-details {
                font-size: 0.75em !important;
                padding: 6px 12px !important;
            }
            
            .property-features {
                font-size: 0.7em !important;
                margin-bottom: 6px !important;
            }
            
            .detail-item {
                padding: 4px 8px !important;
                font-size: 0.75em !important;
            }
            
            .property-price {
                font-size: 1.3em !important;
                margin-bottom: 8px !important;
            }
            
            .view-details {
                padding: 8px 12px !important;
                font-size: 0.85em !important;
            }
            
            .filter-section {
                margin-bottom: 10px;
                padding-bottom: 8px;
            }
            
            .filter-section h3 {
                font-size: 0.9em;
                margin-bottom: 5px;
            }
            
            .range-row {
                display: flex;
                gap: 8px;
            }
            
            .range-row input, .select-field, #location-search {
                padding: 5px 8px;
                font-size: 0.8em;
                flex: 1;
            }
            
            .filter-actions {
                flex-direction: row;
                gap: 8px;
                margin-top: 15px;
            }
            
            .apply-filters-btn, .clear-filters-btn {
                padding: 10px 14px;
                font-size: 0.8em;
            }
        }
        
        /* Continuaci√≥n de estilos m√≥vil vertical */
        @media (max-width: 767px) {
            header {
                padding: 12px 14px;
            }

            .logo-graphic { transform: scale(0.85); transform-origin: left center; }
            .nav-section { gap: 8px; padding: 8px 10px; }
            .nav-item { font-size: 0.75em; padding: 6px 10px; }

            .property-container { padding: 0 10px; }
            
            /* Asegurar que en horizontal no tenga padding */
            @media (max-width: 1024px) and (orientation: landscape) {
                .property-container { padding: 0 !important; }
            }
            .property-card { margin-bottom: 20px; }
            .property-image-container { height: 200px; }
            .carousel-btn { width: 34px; height: 34px; font-size: 1em; }
            .indicator { width: 8px; height: 8px; }

            .property-details-container { padding: 18px; }
            .property-title { font-size: 1.3em; }
            .property-description { font-size: 0.9em; }
            .property-summary { font-size: 0.9em; }
            .property-location { font-size: 0.9em; margin-bottom: 12px; }
            .property-features li { font-size: 0.9em; }
            .property-price { font-size: 1.6em; margin-bottom: 14px; }
            .property-details { gap: 8px; font-size: 0.85em; }
            .detail-item { padding: 6px 12px; font-size: 0.8em; }
            .view-details { padding: 10px 16px; font-size: 0.85em; }

            .pagination { gap: 8px; margin: 24px 0; }
            .page-btn { padding: 8px 12px; font-size: 0.85em; }

            /* Property detail page */
            .property-detail-container { padding: 0 10px; }
            .property-detail-gallery { grid-template-columns: 1fr; gap: 10px; }
            .property-detail-image { height: 220px; }
            .property-detail-info { padding: 20px; }
            .property-detail-title { font-size: 1.6em; }
            .property-detail-price { font-size: 1.8em; }
            .property-detail-features { gap: 6px; }
            .feature-item { padding: 6px 8px; font-size: 0.85em; border-radius: 14px; }
        }

        /* Estilos para la p√°gina de detalles */
        .property-detail-container {
            max-width: 1200px;
            margin: 20px auto;
            padding: 0 15px;
        }

        .property-detail-card {
            background-color: var(--white);
            border-radius: 8px;
            box-shadow: 0 3px 20px rgba(0, 0, 0, 0.08);
            margin-bottom: 30px;
            overflow: hidden;
        }

        /* Media carousel */
        .detail-media {
            display: grid;
            grid-template-columns: 1fr;
            gap: 8px;
            margin-bottom: 16px;
        }
        .detail-hero {
            position: relative;
            width: 100%;
            height: 360px;
            border-radius: 8px;
            overflow: hidden;
            background: var(--light-turquoise);
        }
        .detail-hero img {
            position: absolute;
            inset: 0;
            width: 100%;
            height: 100%;
            object-fit: cover;
            opacity: 0;
            transition: opacity 0.4s ease;
        }
        .detail-hero img.active { opacity: 1; }
        .detail-ctrl {
            position: absolute;
            top: 50%;
            transform: translateY(-50%);
            width: 40px;
            height: 40px;
            border-radius: 50%;
            border: none;
            background: rgba(32,178,170,0.9);
            color: #fff;
            display: grid;
            place-items: center;
            cursor: pointer;
        }
        .detail-ctrl.prev { left: 10px; }
        .detail-ctrl.next { right: 10px; }
        .detail-thumbs {
            display: grid;
            grid-template-columns: 1fr auto;
            gap: 8px;
            align-items: center;
        }
        .thumb-strip {
            display: flex;
            gap: 8px;
            overflow-x: auto;
            padding-bottom: 4px;
        }
        .thumb {
            width: 84px;
            height: 64px;
            border-radius: 6px;
            overflow: hidden;
            flex: 0 0 auto;
            border: 2px solid transparent;
            cursor: pointer;
        }
        .thumb.active { border-color: var(--primary-turquoise); }
        .thumb img { width: 100%; height: 100%; object-fit: cover; display: block; }
        .thumb-count { justify-self: end; color: var(--text-gray); font-size: 0.85em; }

        .property-detail-info {
            padding: 30px;
        }

        .property-detail-title {
            font-size: 2em;
            margin-bottom: 15px;
            color: var(--dark-blue);
        }

         /* Overview section */
         .overview-section {
             margin-top: 12px;
             margin-bottom: 16px;
         }
         .overview-title {
             font-size: 1.2em;
             font-weight: 800;
             color: var(--dark-turquoise);
             margin: 6px 0 14px 0;
         }
         .overview-grid {
             display: grid;
             grid-template-columns: repeat(3, 1fr);
             gap: 18px;
         }
         .overview-group {
             background: var(--white);
             border: 1px solid var(--medium-gray);
             border-radius: 8px;
             padding: 12px 14px;
         }
         .overview-group h4 {
             margin: 0 0 10px 0;
             font-size: 0.95em;
             color: var(--charcoal);
         }
         .overview-row {
             display: flex;
             justify-content: space-between;
             padding: 6px 0;
             border-bottom: 1px dashed var(--medium-gray);
             font-size: 0.92em;
         }
         .overview-row:last-child { border-bottom: none; }
         .overview-key { color: var(--text-gray); }
         .overview-val { color: var(--dark-turquoise); font-weight: 700; }

        .property-detail-price {
            font-size: 2.2em;
            margin-bottom: 20px;
            color: var(--primary-blue);
        }

         .property-detail-description {
            margin-bottom: 30px;
            line-height: 1.8;
            color: var(--text-gray);
        }

        .property-detail-features {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            margin-bottom: 20px;
        }

        .feature-item {
            display: inline-flex;
            align-items: center;
            gap: 6px;
            padding: 6px 10px;
            background: var(--light-turquoise);
            border: 1px solid var(--medium-turquoise);
            border-radius: 16px;
            color: var(--dark-turquoise);
            font-weight: 600;
            font-size: 0.9em;
            line-height: 1;
        }

        .feature-item .label {
            color: var(--dark-turquoise);
            font-weight: 700;
        }

        .back-button {
            display: inline-block;
            padding: 10px 20px;
            background-color: var(--primary-blue);
            color: white;
            text-decoration: none;
            border-radius: 4px;
            margin-bottom: 20px;
            transition: background-color 0.3s;
        }

        .back-button:hover {
            background-color: var(--dark-blue);
        }

        /* Map in property detail */
        #property-map {
            width: 100%;
            height: 60dvh;
            border-radius: 12px;
            border: 1px solid #e9ecef;
            box-shadow: 0 4px 18px rgba(32, 178, 170, 0.08);
            margin-top: 20px;
        }
        .map-legend {
            display: flex;
            flex-wrap: wrap;
            gap: 12px 18px;
            align-items: center;
            margin-top: 10px;
            color: var(--text-gray);
            font-size: 0.9em;
        }
        .legend-item { display: inline-flex; align-items: center; gap: 8px; }
        .legend-item img { width: 20px; height: 20px; display: block; border-radius: 50%; }

        /* Ajuste de marca de agua para m√≥viles (layout vertical) */
        @media (max-width: 767px) {
            .property-card::before {
                top: 278px; /* Despu√©s de la imagen + padding, altura del t√≠tulo/ubicaci√≥n */
                left: 0;
                height: 180px; /* Altura desde ubicaci√≥n hasta precio en m√≥viles */
                background-size: 320px auto;
                background-image: url('data:image/svg+xml;charset=utf-8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 600 300"><g transform="rotate(305 300 150)" opacity="0.3"><g fill="none" stroke="%2320B2AA" stroke-width="6"><path d="M100 200 Q150 150 200 200" fill="none"/><rect x="108" y="184" width="85" height="6" rx="4" fill="%2320B2AA"/><rect x="100" y="200" width="250" height="6" rx="100" fill="%2320B2AA"/></g><text x="210" y="195" font-family="Arial" font-size="32" font-weight="900" fill="%23003366" letter-spacing="3px">MBI</text></g></svg>');
            }
        }

        /* Language selector styles */
        .lang-selector {
            position: relative;
            margin-left: auto;
            z-index: 10000;
        }
        
        .lang-btn {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            padding: 8px 12px;
            background: #fff;
            border-radius: 4px;
            box-shadow: none;
            border: none;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 14px;
            line-height: 1.2;
            font-family: 'Arial', 'Segoe UI Emoji', 'Apple Color Emoji', 'Noto Color Emoji', sans-serif !important;
        }
        
        .lang-btn * {
            font-family: 'Arial', 'Segoe UI Emoji', 'Apple Color Emoji', 'Noto Color Emoji', sans-serif !important;
        }
        
        .lang-btn:hover {
            background: var(--light-turquoise);
            transform: translateY(-1px);
        }
        
        .lang-menu {
            position: absolute;
            right: 0;
            top: 110%;
            background: #fff;
            border: 1px solid #E9ECEF;
            border-radius: 6px;
            box-shadow: 0 6px 16px rgba(0,0,0,0.12);
            display: none;
            min-width: 160px;
            z-index: 9999;
        }
        
        .lang-option {
            display: flex;
            gap: 8px;
            align-items: center;
            padding: 8px 12px;
            cursor: pointer;
            font-weight: 600;
            transition: background-color 0.2s ease;
            font-size: 14px;
            font-family: 'Arial', 'Segoe UI Emoji', 'Apple Color Emoji', 'Noto Color Emoji', sans-serif !important;
        }
        
        .lang-option:hover {
            background: var(--light-turquoise);
        }
        
        /* Desktop: SVG flags, Mobile: emoji flags */
        @media (min-width: 768px) {
            /* Ocultar el emoji en el bot√≥n y mostrar solo nombre con bandera SVG */
            .lang-btn { font-size: 0; }
            .lang-btn span { font-size: 14px; }

            /* Banderas SVG para el bot√≥n actual */
            .lang-btn[data-lang="en"]::before,
            .lang-option[data-lang="en"]::before {
                content: '';
                display: inline-block;
                width: 20px; height: 15px; margin-right: 8px;
                background-image: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 60 30"><rect width="60" height="30" fill="%23b22234"/><path fill="%23fff" d="M0,3h60v3H0zm0,6h60v3H0zm0,6h60v3H0zm0,6h60v3H0zm0,6h60v3H0z"/><rect width="24" height="15" fill="%23002b7f"/><g fill="%23fff"><circle cx="2" cy="2" r="1"/><circle cx="6" cy="2" r="1"/><circle cx="10" cy="2" r="1"/><circle cx="14" cy="2" r="1"/><circle cx="18" cy="2" r="1"/><circle cx="4" cy="4" r="1"/><circle cx="8" cy="4" r="1"/><circle cx="12" cy="4" r="1"/><circle cx="16" cy="4" r="1"/><circle cx="20" cy="4" r="1"/></g></svg>');
                background-size: contain; background-repeat: no-repeat;
            }
            .lang-btn[data-lang="es"]::before,
            .lang-option[data-lang="es"]::before {
                content: '';
                display: inline-block;
                width: 20px; height: 15px; margin-right: 8px;
                background-image: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 60 40"><rect width="60" height="40" fill="%23AA151B"/><rect y="10" width="60" height="20" fill="%23F1BF00"/></svg>');
                background-size: contain; background-repeat: no-repeat;
            }
            .lang-btn[data-lang="fr"]::before,
            .lang-option[data-lang="fr"]::before {
                content: '';
                display: inline-block;
                width: 20px; height: 15px; margin-right: 8px;
                background-image: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 60 40"><rect width="20" height="40" fill="%23005EB8"/><rect x="20" width="20" height="40" fill="%23fff"/><rect x="40" width="20" height="40" fill="%23EF4135"/></svg>');
                background-size: contain; background-repeat: no-repeat;
            }
            .lang-btn[data-lang="de"]::before,
            .lang-option[data-lang="de"]::before {
                content: '';
                display: inline-block;
                width: 20px; height: 15px; margin-right: 8px;
                background-image: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 60 40"><rect width="60" height="13.33" fill="%23000000"/><rect y="13.33" width="60" height="13.33" fill="%23DD0000"/><rect y="26.66" width="60" height="13.33" fill="%23FFCE00"/></svg>');
                background-size: contain; background-repeat: no-repeat;
            }
        }

        /* Media queries para tablets y desktop */
         @media (min-width: 1025px) {
            header {
                flex-direction: row;
                justify-content: space-between;
                padding: 15px 40px;
            }
            
            .header-content {
                flex-direction: row;
                justify-content: space-between;
                align-items: center;
            }
            
            .logo-section {
                flex-direction: row;
                align-items: center;
                margin-bottom: 0;
                width: auto;
            }
            
            .logo-graphic {
                margin: 0 20px 0 0;
                width: 350px;
            }
            
            .nav-section {
                width: auto;
                padding: 8px 18px;
                gap: 10px;
            }
            
            .nav-item {
                font-size: 0.85em;
                padding: 8px 15px;
            }

            /* Layout de sidebar para desktop */
            .main-layout {
                gap: 0;
                max-width: none;
                margin: 0;
                padding: 0;
            }

            .filters-panel {
                position: fixed;
                top: 140px;
                left: 0;
                width: 300px;
                height: calc(100dvh - 140px);
                border-radius: 0;
                box-shadow: 2px 0 10px rgba(32, 178, 170, 0.1);
                border-right: 2px solid var(--light-turquoise);
                z-index: 10;
            }

            .content-area {
                margin-left: 300px !important;
                padding: 20px !important;
                padding-top: 20px !important;
            }
            
            .property-card {
                flex-direction: row;
                min-height: 400px;
            }

            /* Ajuste de marca de agua para layout horizontal */
            .property-card::before {
                left: 50%; /* En desktop, la imagen ocupa la mitad izquierda */
                top: 30px; /* Altura del t√≠tulo/ubicaci√≥n en desktop */
                height: 220px; /* Altura desde ubicaci√≥n hasta precio en desktop */
                background-size: 420px auto;
                background-image: url('data:image/svg+xml;charset=utf-8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 600 300"><g transform="rotate(305 300 150)" opacity="0.3"><g fill="none" stroke="%2320B2AA" stroke-width="6"><path d="M100 200 Q150 150 200 200" fill="none"/><rect x="108" y="184" width="85" height="6" rx="4" fill="%2320B2AA"/><rect x="100" y="200" width="250" height="6" rx="100" fill="%2320B2AA"/></g><text x="210" y="195" font-family="Arial" font-size="32" font-weight="900" fill="%23003366" letter-spacing="3px">MBI</text></g></svg>');
            }
            
            .property-image-container {
                flex: 1;
                height: auto;
                min-width: 50%;
            }
            
            .property-details-container {
                flex: 1;
                padding: 30px;
            }
            
            .view-details {
                width: auto;
            }

             /* Detalle responsivo */
             .detail-hero { height: 440px; }
             .detail-media { margin-bottom: 20px; }
             .overview-grid { grid-template-columns: repeat(3, 1fr); }
        }

         @media (max-width: 767px) {
             .overview-grid { grid-template-columns: 1fr; }
         }
        
        @media (min-width: 1024px) {
            .logo-graphic {
                width: 400px;
            }
            
            .nav-section {
                gap: 15px;
            }
        }
        
        /* Animaciones para mensajes de filtros */
        @keyframes slideInRight {
            from {
                transform: translateX(100%);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }
        
        @keyframes slideOutRight {
            from {
                transform: translateX(0);
                opacity: 1;
            }
            to {
                transform: translateX(100%);
                opacity: 0;
            }
        }
        
        
        .cookie-text {
            font-size: .95em;
            color: var(--charcoal);
        }
        
        .cookie-actions {
            display: flex;
            gap: 8px;
        }
        
        .cookie-btn {
            background: var(--primary-turquoise);
            border: none;
            color: #fff;
            font-weight: 700;
            border-radius: 6px;
            padding: 8px 12px;
            cursor: pointer;
        }
        
        .cookie-link-btn {
            background: transparent;
            border: 1px solid var(--primary-turquoise);
            color: var(--primary-turquoise);
            font-weight: 700;
            border-radius: 6px;
            padding: 8px 12px;
            cursor: pointer;
        }
        
        @media (max-width: 600px) {
            .legal-subheader .legal-container {
                flex-direction: column;
                align-items: flex-start;
                gap: 6px;
            }
            .cookie-banner {
                flex-direction: column;
                align-items: flex-start;
            }
        }
    </style>
    <style>
        /* Overrides to match home2 header */
        header{background:#fff}
        .logo-section { display:flex; flex-direction:column; align-items:flex-start; justify-content:center; margin-bottom:0; width:auto; height:200px; overflow:visible; }
        .logo-section img { max-height:200px; height:auto; width:auto; display:block; object-fit:contain; }
        .logo-graphic{height:160px;overflow:visible;align-items:flex-start;justify-content:flex-start}
        .semicircle{bottom:60px;width:100px;height:100px;border:4px solid #1e3a8a;border-radius:50%;background:transparent;z-index:20}
        .horizon-line{bottom:60px;height:2px;background-color:#1e3a8a;z-index:20}
        .semicircle-underline{bottom:50px;height:2px;background-color:#1e3a8a;z-index:20}
        .logo-text{position:absolute;top:120px;left:0;z-index:5;align-items:flex-start;text-align:left;white-space:nowrap;height:auto;pointer-events:none}
        .logo-main{color:#7dd3fc;text-shadow:none}
        .logo-sub{display:block;font-weight:800;color:#7dd3fc;margin-top:2px;text-align:center}
        @media (max-width:767px){
            header { padding: 15px 20px; max-height: 230px; overflow: visible; align-items: center; }
            .logo-section { height: auto; overflow: visible; min-width: 150px; }
            .logo-section img { max-height: 220px; width: auto; height: auto; display: block; object-fit: contain; }
            .header-content{display:flex;align-items:center}
            .logo-section{flex:0 0 auto}
            .horizon-line{ width:240px; }
            .logo-text{ white-space: normal; }
            .logo-main .logo-chunk{ display:block; text-align:left; white-space:nowrap; }
            .logo-main .logo-chunk:last-child{ text-align:center; }
            .nav-section{margin-left:auto;justify-content:flex-start;align-items:flex-end;flex-direction:column;flex-wrap:nowrap;gap:10px;padding:8px 10px}
            .nav-item{font-size:.75em;padding:6px 10px}
            .logo-graphic{transform:scale(.85);transform-origin:left center}
        }
    </style>
</head>
<body>
    
    <header>
        <div class="header-content">
            <div class="logo-section">
                <img src="logo.png" alt="Mediterranean Blue International LLC Realty"/>
            </div>
            
            <div class="nav-section">
                <a href="home.html" class="nav-item" data-i18n="nav.home">Home</a>
                <a href="casas.html" class="nav-item active" data-i18n="nav.properties">Properties</a>
                <a href="news.html" class="nav-item" data-i18n="nav.news">News</a>
                <a href="Contact.html" class="nav-item" data-i18n="nav.contact">Contact</a>
                <div class="lang-selector" id="langSelector" style="margin-left:auto">
                    <div class="lang-btn" id="langBtn" style="display:inline-flex;align-items:center;gap:8px;padding:8px 12px;background:#fff;border-radius:4px;box-shadow:none;border:none;font-weight:700;cursor:pointer">üá∫üá∏ <span id="langLabel">English</span></div>
                    <div class="lang-menu" id="langMenu" style="position:absolute;right:0;top:110%;background:#fff;border:1px solid #E9ECEF;border-radius:6px;box-shadow:0 6px 16px rgba(0,0,0,0.12);display:none;min-width:160px;z-index:50">
                        <div class="lang-option" data-lang="en" style="display:flex;gap:8px;align-items:center;padding:8px 12px;cursor:pointer;font-weight:600">üá∫üá∏ English</div>
                        <div class="lang-option" data-lang="es" style="display:flex;gap:8px;align-items:center;padding:8px 12px;cursor:pointer;font-weight:600">üá™üá∏ Espa√±ol</div>
                        <div class="lang-option" data-lang="fr" style="display:flex;gap:8px;align-items:center;padding:8px 12px;cursor:pointer;font-weight:600">üá´üá∑ Fran√ßais</div>
                        <div class="lang-option" data-lang="de" style="display:flex;gap:8px;align-items:center;padding:8px 12px;cursor:pointer;font-weight:600">üá©üá™ Deutsch</div>
                    </div>
                </div>
            </div>
        </div>
    </header>
    <script>
        (function(){
          const I18N = {
            en:{'nav.home':'Home','nav.properties':'Properties','nav.news':'News','nav.contact':'Contact'},
            es:{'nav.home':'Inicio','nav.properties':'Propiedades','nav.news':'Noticias','nav.contact':'Contacto'},
            fr:{'nav.home':'Accueil','nav.properties':'Propri√©t√©s','nav.news':'Actualit√©s','nav.contact':'Contact'},
            de:{'nav.home':'Start','nav.properties':'Immobilien','nav.news':'News','nav.contact':'Kontakt'}
          };
          async function apply(){
            const lang = localStorage.getItem('mbi_lang')||'en';
            const dict = I18N[lang]||I18N.en;
            document.querySelectorAll('[data-i18n]').forEach(el=>{ const k=el.getAttribute('data-i18n'); if(dict[k]) el.textContent=dict[k]; });
            const label={en:'English',es:'Espa√±ol',fr:'Fran√ßais',de:'Deutsch'}[lang]||'English';
            const flag={en:'üá∫üá∏',es:'üá™üá∏',fr:'üá´üá∑',de:'üá©üá™'}[lang]||'üá∫üá∏';
            const btn=document.getElementById('langBtn'); 
            if(btn){ 
                btn.setAttribute('data-lang', lang); 
                // En desktop usar solo el texto (las banderas SVG se muestran con ::before)
                // En m√≥vil usar emoji + texto
                if (window.innerWidth >= 768) {
                    btn.innerHTML = '<span id="langLabel">' + label + '</span>';
                } else {
                    btn.innerHTML = flag + ' <span id="langLabel">' + label + '</span>';
                    // Forzar el renderizado de emojis en m√≥vil
                    btn.style.fontFamily = 'Arial, "Segoe UI Emoji", "Apple Color Emoji", "Noto Color Emoji", sans-serif';
                }
            }
            
            // Update dropdown options for desktop SVG flags
            if (window.innerWidth >= 768) {
                document.querySelectorAll('.lang-option').forEach(option => {
                    const langCode = option.getAttribute('data-lang');
                    const labels = {en:'English', es:'Espa√±ol', fr:'Fran√ßais', de:'Deutsch'};
                    option.innerHTML = labels[langCode] || 'English';
                });
            } else {
                // En m√≥vil (incluyendo horizontal), mantener los emojis
                document.querySelectorAll('.lang-option').forEach(option => {
                    const langCode = option.getAttribute('data-lang');
                    const flags = {en:'üá∫üá∏', es:'üá™üá∏', fr:'üá´üá∑', de:'üá©üá™'};
                    const labels = {en:'English', es:'Espa√±ol', fr:'Fran√ßais', de:'Deutsch'};
                    option.innerHTML = (flags[langCode] || 'üá∫üá∏') + ' ' + (labels[langCode] || 'English');
                    // Forzar el renderizado de emojis
                    option.style.fontFamily = 'Arial, "Segoe UI Emoji", "Apple Color Emoji", "Noto Color Emoji", sans-serif';
                });
            }
            
            // Traducir contenido din√°mico de propiedades (con delay para asegurar que el DOM est√© listo)
            setTimeout(async () => {
                try {
                    await translateDynamicProperties();
                } catch (error) {
                    console.error('Error en traducci√≥n din√°mica:', error);
                }
            }, 100);
          }
          function init(){
            apply();
            const btn=document.getElementById('langBtn'); const menu=document.getElementById('langMenu');
            if(btn&&menu){
              btn.addEventListener('click',()=> menu.style.display=(menu.style.display==='block'?'none':'block'));
              menu.querySelectorAll('.lang-option').forEach(opt=>{
                opt.addEventListener('click',()=>{ 
                  localStorage.setItem('mbi_lang', opt.getAttribute('data-lang')); 
                  menu.style.display='none'; 
                  apply();
                  try { applyFiltersI18n(); } catch(_) {}
                });
              });
              document.addEventListener('click',(e)=>{ if(!menu.contains(e.target)&&!btn.contains(e.target)) menu.style.display='none'; });
            }
            // Actualizar banderas al cambiar el tama√±o de la ventana
            window.addEventListener('resize', apply);
          }
          document.addEventListener('DOMContentLoaded', init);
        })();
    </script>
    
    <div id="app-content">
        <div class="main-layout">
            <!-- Panel de filtros izquierdo -->
            <div class="filters-panel" id="filters-panel">
                <div class="filters-header">
                    <h2 style="margin: 0; font-size: 1.1em; color: var(--dark-turquoise);" data-i18n="filters.title">Search Filters</h2>
                    <button class="toggle-filters-btn" id="toggle-filters" onclick="toggleFilters()">
                        <span id="toggle-icon">‚ñº</span>
                    </button>
                </div>
                <div class="filters-content" id="filters-content">
                <div class="filter-section">
                    <h3 data-i18n="filters.location">Location</h3>
                    <div class="search-container">
                        <input type="text" id="location-search" data-i18n-ph="filters.location.ph" placeholder="Search location..." autocomplete="off">
                        <div id="location-suggestions" class="suggestions-dropdown"></div>
                    </div>
                </div>
                
                <div class="filter-section">
                    <h3 data-i18n="filters.price">Price (‚Ç¨)</h3>
                    <div class="range-row">
                        <input type="number" id="price-min" data-i18n-ph="filters.min" placeholder="Minimum">
                        <input type="number" id="price-max" data-i18n-ph="filters.max" placeholder="Maximum">
                    </div>
                </div>
                <div class="filter-actions">
                    <button id="apply-filters" class="apply-filters-btn" data-i18n="filters.apply">Apply Filters</button>
                    <button id="clear-filters" class="clear-filters-btn" data-i18n="filters.clear">Clear</button>
                </div>
                </div>
            </div>
            
            <!-- Contenido principal -->
            <div class="content-area">
                <div class="property-container" id="properties-container">
                    <div class="loading">Loading properties...</div>
                </div>
                
                <div class="pagination" id="pagination-container"></div>
            </div>
        </div>
    </div>
    
    <footer>
        <a href="mailto:mblueinter@gmail.com" style="color: var(--ink); text-decoration: underline;">mblueinter@gmail.com</a>
        <span style="margin:0 6px;"> </span>
        ¬© 2025 Mediterranean Blue International Realty. Todos los derechos reservados ¬∑
        <a href="#" id="footerLegalLink" style="color: #ffffff; text-decoration:underline; font-weight:700">Cookies y t√©rminos</a>
        <div style="text-align:center; margin-top:6px;">
            <a href="https://xkmarasa.github.io/rxdev-presentation.html" target="_blank" rel="noopener noreferrer" style="color: var(--white); text-decoration: underline;">@https://www.RXDev.com/es</a>
        </div>
    </footer>
    
    <!-- Modal Legal -->
    <div class="legal-modal-backdrop" id="legalModal" aria-hidden="true" role="dialog" aria-labelledby="legalTitle">
        <div class="legal-modal">
            <button class="legal-close" id="legalClose" aria-label="Cerrar">&times;</button>
            <h2 class="legal-title" id="legalTitle">Informaci√≥n Legal</h2>
            <div class="legal-tabs">
                <button class="legal-tab active" data-target="aviso">Aviso Legal</button>
                <button class="legal-tab" data-target="terminos">T√©rminos y Condiciones</button>
                <button class="legal-tab" data-target="cookies">Pol√≠tica de Cookies</button>
            </div>
            <div class="legal-content">
                <section class="legal-section" id="sec-aviso">
                    <h3>Aviso legal</h3>
                    <p>Este sitio web pertenece a Mediterranean Blue International LLC (MBI). La informaci√≥n mostrada tiene car√°cter meramente informativo y no constituye asesoramiento profesional ni oferta vinculante. MBI procura que los datos de las propiedades sean exactos y actualizados, sin garantizar su exhaustividad o exactitud. Las im√°genes pueden ser ilustrativas. El usuario debe verificar la informaci√≥n y disponibilidad.</p>
                    <p>Queda prohibida la reproducci√≥n total o parcial de los contenidos sin autorizaci√≥n. Para consultas o notificaciones legales, utilice los datos de contacto publicados en la secci√≥n Contacto.</p>
                </section>
                <section class="legal-section" id="sec-terminos" hidden>
                    <h3>T√©rminos y condiciones</h3>
                    <p>El uso de este sitio implica la aceptaci√≥n de estos t√©rminos: (i) el usuario se compromete a realizar un uso l√≠cito y conforme a la buena fe; (ii) MBI podr√° actualizar contenidos y funcionalidades sin previo aviso; (iii) los enlaces externos se facilitan como cortes√≠a y MBI no es responsable de su contenido; (iv) la propiedad intelectual del sitio y su dise√±o pertenece a MBI o a sus licenciantes.</p>
                    <p>La contrataci√≥n de servicios o la intermediaci√≥n inmobiliaria, en su caso, quedar√° sujeta a condiciones particulares que se proporcionar√°n al cliente antes de su formalizaci√≥n.</p>
                </section>
                <section class="legal-section" id="sec-cookies" hidden>
                    <h3>Pol√≠tica de cookies</h3>
                    <p>Este sitio utiliza √∫nicamente cookies t√©cnicas necesarias para su funcionamiento b√°sico. No se utilizan cookies de seguimiento, publicitarias o de an√°lisis. Las cookies t√©cnicas permiten la navegaci√≥n y el uso de las funciones b√°sicas del sitio web.</p>
                    <p>Al continuar navegando, acepta el uso de estas cookies t√©cnicas. Puede configurar su navegador para rechazar las cookies, aunque esto puede afectar la funcionalidad del sitio.</p>
                </section>
            </div>
        </div>
    </div>
    
    <!-- Banner de cookies -->
    <div class="cookie-banner" id="cookieBanner" aria-live="polite" hidden>
        <div class="cookie-text">Usamos cookies t√©cnicas necesarias para que el sitio funcione. Al continuar, acepta su uso.</div>
        <div class="cookie-actions">
            <button class="cookie-btn" id="cookieAccept">Aceptar</button>
            <button class="cookie-link-btn" id="cookieMore">M√°s informaci√≥n</button>
        </div>
    </div>
    
    <script>
        // Variables globales para filtros
        let currentFilters = {
            location: '',
            priceMin: null,
            priceMax: null,
            requirements: '',
            aiAnalysis: null
        };
        // Variable global para todas las propiedades
        let allProperties = [];
        
        // B√∫squeda de ubicaci√≥n con Google Places Autocomplete (ciudades, regiones y pa√≠ses)
        // Usando el m√©todo legacy Autocomplete (a√∫n funcional, pero deprecado para nuevos clientes)
        // El warning se puede ignorar ya que el servicio seguir√° funcionando por al menos 12 meses m√°s
        function initLocationSearch() {
            const searchInput = document.getElementById('location-search');
            if (!searchInput) return;
            
            // Verificar que Google Maps est√© cargado
            if (!window.google || !google.maps || !google.maps.places) {
                console.warn('Google Maps Places no est√° disponible a√∫n, reintentando en 500ms...');
                setTimeout(initLocationSearch, 500);
                return;
            }
            
            // Evitar inicializar m√∫ltiples veces
            if (searchInput.dataset.autocompleteInitialized === 'true') {
                return;
            }
            searchInput.dataset.autocompleteInitialized = 'true';
            
            // Usar Autocomplete legacy (a√∫n funcional para clientes existentes)
            // NOTA: Este m√©todo est√° deprecado para nuevos clientes desde marzo 2025,
            // pero seguir√° funcionando para clientes existentes. Google dar√° al menos
            // 12 meses de aviso antes de descontinuarlo.
            try {
                const autocomplete = new google.maps.places.Autocomplete(searchInput, {
                    types: ['(regions)'], // incluye pa√≠ses, regiones y localidades
                    fields: ['name', 'formatted_address', 'address_components', 'geometry']
                });
                autocomplete.addListener('place_changed', () => {
                    const place = autocomplete.getPlace();
                    const value = place.formatted_address || place.name || searchInput.value;
                    searchInput.value = value; // autocompletar en el input
                    currentFilters.location = value; // guardar en filtros
                });
            } catch (error) {
                console.error('Error inicializando Autocomplete:', error);
            }
        }
        // === i18n para filtros ===
        const I18N_FILTERS = {
            en:{'filters.title':'Search Filters','filters.location':'Location','filters.location.ph':'Search location...','filters.price':'Price (‚Ç¨)','filters.min':'Minimum','filters.max':'Maximum','filters.type':'Property Type','filters.any':'Any','filters.type.house':'House / Villa','filters.type.apartment':'Apartment / Flat','filters.type.townhouse':'Townhouse','filters.type.plot':'Plot','filters.type.commercial':'Commercial','filters.type.other':'Other','filters.bedrooms':'Bedrooms','filters.anyAmount':'Any amount','filters.bathrooms':'Bathrooms','filters.size':'Size (m¬≤)','filters.apply':'Apply Filters','filters.clear':'Clear'},
            es:{'filters.title':'Filtros de B√∫squeda','filters.location':'Ubicaci√≥n','filters.location.ph':'Buscar ubicaci√≥n...','filters.price':'Precio (‚Ç¨)','filters.min':'M√≠nimo','filters.max':'M√°ximo','filters.type':'Tipo de Propiedad','filters.any':'Todos','filters.type.house':'Casa / Villa','filters.type.apartment':'Apartamento / Piso','filters.type.townhouse':'Adosado','filters.type.plot':'Parcela','filters.type.commercial':'Comercial','filters.type.other':'Otros','filters.bedrooms':'Dormitorios','filters.anyAmount':'Cualquier cantidad','filters.bathrooms':'Ba√±os','filters.size':'Tama√±o (m¬≤)','filters.apply':'Aplicar Filtros','filters.clear':'Limpiar'},
            fr:{'filters.title':'Filtres de recherche','filters.location':'Localisation','filters.location.ph':'Rechercher un lieu...','filters.price':'Prix (‚Ç¨)','filters.min':'Minimum','filters.max':'Maximum','filters.type':'Type de propri√©t√©','filters.any':'Tous','filters.type.house':'Maison / Villa','filters.type.apartment':'Appartement','filters.type.townhouse':'Maison de ville','filters.type.plot':'Terrain','filters.type.commercial':'Commercial','filters.type.other':'Autres','filters.bedrooms':'Chambres','filters.anyAmount':'N\'importe quel nombre','filters.bathrooms':'Salles de bain','filters.size':'Superficie (m¬≤)','filters.apply':'Appliquer les filtres','filters.clear':'Effacer'},
            de:{'filters.title':'Suchfilter','filters.location':'Ort','filters.location.ph':'Ort suchen...','filters.price':'Preis (‚Ç¨)','filters.min':'Minimum','filters.max':'Maximum','filters.type':'Immobilienart','filters.any':'Alle','filters.type.house':'Haus / Villa','filters.type.apartment':'Apartment / Wohnung','filters.type.townhouse':'Reihenhaus','filters.type.plot':'Grundst√ºck','filters.type.commercial':'Gewerbe','filters.type.other':'Sonstige','filters.bedrooms':'Schlafzimmer','filters.anyAmount':'Beliebig','filters.bathrooms':'Badezimmer','filters.size':'Gr√∂√üe (m¬≤)','filters.apply':'Filter anwenden','filters.clear':'Zur√ºcksetzen'}
        };
        function applyFiltersI18n(){
            const lang = localStorage.getItem('mbi_lang')||'en';
            const dict = I18N_FILTERS[lang]||I18N_FILTERS.en;
            document.querySelectorAll('#filters-panel [data-i18n]').forEach(el=>{
                const k=el.getAttribute('data-i18n'); if(dict[k]) el.textContent=dict[k];
            });
            document.querySelectorAll('#filters-panel [data-i18n-ph]').forEach(el=>{
                const k=el.getAttribute('data-i18n-ph'); if(dict[k]) el.setAttribute('placeholder', dict[k]);
            });
            document.querySelectorAll('#filters-panel [data-i18n-ph-multi]').forEach(el=>{
                const k=el.getAttribute('data-i18n-ph-multi'); if(dict[k]) el.setAttribute('placeholder', dict[k]);
            });
        }
        document.addEventListener('DOMContentLoaded', applyFiltersI18n);
        
        // (Eliminado) Selector de tipo de propiedad
        
        
        // Funcionalidad de aplicaci√≥n de filtros
        function initFilterActions() {
            const applyBtn = document.getElementById('apply-filters');
            const clearBtn = document.getElementById('clear-filters');
            
            applyBtn.addEventListener('click', function() {
                // Leer todos los valores de los filtros
                const minPriceEl = document.getElementById('price-min');
                const maxPriceEl = document.getElementById('price-max');
                const locEl = document.getElementById('location-search');
                
                // Procesar valores num√©ricos
                const minPriceVal = parseFloat(minPriceEl && minPriceEl.value);
                const maxPriceVal = parseFloat(maxPriceEl && maxPriceEl.value);
                
                
                // Actualizar filtros globales
                currentFilters.priceMin = Number.isFinite(minPriceVal) ? minPriceVal : null;
                currentFilters.priceMax = Number.isFinite(maxPriceVal) ? maxPriceVal : null;
                currentFilters.location = locEl ? (locEl.value || '').trim() : '';
                
                applyFilters();
            });
            
            clearBtn.addEventListener('click', function() {
                clearFilters();
            });
        }
        
        async function applyFilters() {
            console.log('üîç Aplicando filtros:', currentFilters);
            console.log('üìä Total propiedades disponibles:', allProperties.length);
            
            // Verificar si hay alg√∫n filtro activo
            const hasActiveFilters = 
                (currentFilters.location && currentFilters.location.trim() !== '') ||
                (currentFilters.priceMin !== null && !isNaN(currentFilters.priceMin) && currentFilters.priceMin > 0) ||
                (currentFilters.priceMax !== null && !isNaN(currentFilters.priceMax) && currentFilters.priceMax > 0);
            
            console.log('üéØ Filtros activos:', hasActiveFilters);
            
            // Si no hay filtros activos, mostrar todas las propiedades
            if (!hasActiveFilters) {
                await updatePropertiesDisplay();
                showFilterMessage('info', 'Cat√°logo Completo', `Visualizando el cat√°logo completo de ${allProperties.length} propiedades disponibles en nuestro portfolio.`);
                return;
            }
            
            // Filtrar propiedades bas√°ndose en los criterios
            const filteredProperties = filterProperties(allProperties, currentFilters);
            console.log('‚úÖ Propiedades filtradas:', filteredProperties.length);
            
            // Actualizar la visualizaci√≥n con las propiedades filtradas usando funci√≥n simple
            displayFilteredPropertiesSimple(filteredProperties);
            
            // Mostrar mensaje de resultados m√°s informativo y formal
            const resultsCount = filteredProperties.length;
            const totalCount = allProperties.length;
            const percentage = Math.round((resultsCount / totalCount) * 100);
            
            if (resultsCount === 0) {
                showFilterMessage('warning', 'B√∫squeda Sin Resultados', 'Lamentamos informar que no se han encontrado propiedades que cumplan con los criterios de b√∫squeda especificados. Le sugerimos revisar y ajustar los filtros aplicados para ampliar los resultados de su consulta.');
            } else if (resultsCount === totalCount) {
                showFilterMessage('success', 'B√∫squeda Completa', `Excelente. La totalidad de nuestras ${totalCount} propiedades en cat√°logo satisfacen los criterios de b√∫squeda establecidos.`);
            } else {
                showFilterMessage('success', 'Resultados de B√∫squeda', `Su consulta ha generado ${resultsCount} propiedades de un total de ${totalCount} disponibles (${percentage}% del cat√°logo), todas ellas cumpliendo con los criterios especificados.`);
            }
        }
        
        function showFilterMessage(type, title, message) {
            // Crear un mensaje temporal m√°s elegante y formal
            const messageDiv = document.createElement('div');
            messageDiv.className = `filter-message ${type}`;
            
            // Iconos m√°s profesionales seg√∫n el tipo
            const icons = {
                success: '‚úì',
                warning: '‚ö†',
                info: '‚Ñπ',
                error: '‚úó'
            };
            
            messageDiv.innerHTML = `
                <div class="filter-message-icon">${icons[type] || icons.info}</div>
                <div class="filter-message-content">
                    <div class="filter-message-title">${title}</div>
                    <div class="filter-message-text">${message}</div>
                </div>
                <button class="filter-message-close" onclick="this.parentElement.remove()" title="Cerrar notificaci√≥n">√ó</button>
            `;
            
            // Estilos inline para el mensaje m√°s profesionales
            messageDiv.style.cssText = `
                position: fixed;
                top: 20px;
                right: 20px;
                background: linear-gradient(135deg, #ffffff 0%, #f8fffe 100%);
                border: 1px solid var(--dark-turquoise);
                border-left: 4px solid var(--dark-turquoise);
                border-radius: 12px;
                padding: 0;
                box-shadow: 0 8px 32px rgba(0,0,0,0.12), 0 2px 8px rgba(0,0,0,0.08);
                z-index: 1000;
                max-width: 450px;
                min-width: 350px;
                font-family: 'Poppins', sans-serif;
                animation: slideInRight 0.4s cubic-bezier(0.25, 0.46, 0.45, 0.94);
                display: flex;
                align-items: flex-start;
                gap: 12px;
                overflow: hidden;
            `;
            
            // Estilos para el icono
            const iconElement = messageDiv.querySelector('.filter-message-icon');
            if (iconElement) {
                iconElement.style.cssText = `
                    background: var(--dark-turquoise);
                    color: white;
                    width: 32px;
                    height: 32px;
                    border-radius: 50%;
                    display: flex;
                    align-items: center;
                    justify-content: center;
                    font-weight: bold;
                    font-size: 16px;
                    margin: 16px 0 16px 16px;
                    flex-shrink: 0;
                `;
            }
            
            // Estilos para el contenido
            const contentElement = messageDiv.querySelector('.filter-message-content');
            if (contentElement) {
                contentElement.style.cssText = `
                    flex: 1;
                    padding: 16px 8px 16px 0;
                `;
            }
            
            // Estilos para el t√≠tulo
            const titleElement = messageDiv.querySelector('.filter-message-title');
            if (titleElement) {
                titleElement.style.cssText = `
                    font-weight: 600;
                    font-size: 16px;
                    color: var(--dark-turquoise);
                    margin-bottom: 6px;
                    letter-spacing: 0.3px;
                `;
            }
            
            // Estilos para el texto
            const textElement = messageDiv.querySelector('.filter-message-text');
            if (textElement) {
                textElement.style.cssText = `
                    font-size: 14px;
                    color: #4a5568;
                    line-height: 1.5;
                    font-weight: 400;
                `;
            }
            
            // Estilo del bot√≥n de cerrar m√°s elegante
            const closeBtn = messageDiv.querySelector('.filter-message-close');
            if (closeBtn) {
                closeBtn.style.cssText = `
                    position: absolute;
                    top: 8px;
                    right: 8px;
                    background: none;
                    border: none;
                    font-size: 20px;
                    color: #a0aec0;
                    cursor: pointer;
                    width: 24px;
                    height: 24px;
                    display: flex;
                    align-items: center;
                    justify-content: center;
                    border-radius: 50%;
                    transition: all 0.2s ease;
                `;
                
                closeBtn.addEventListener('mouseenter', function() {
                    this.style.background = '#f7fafc';
                    this.style.color = '#2d3748';
                });
                
                closeBtn.addEventListener('mouseleave', function() {
                    this.style.background = 'none';
                    this.style.color = '#a0aec0';
                });
            }
            
            document.body.appendChild(messageDiv);
            
            // Auto-remover despu√©s de 5 segundos
            setTimeout(() => {
                if (messageDiv.parentElement) {
                    messageDiv.style.animation = 'slideOutRight 0.3s ease';
                    setTimeout(() => messageDiv.remove(), 300);
                }
            }, 5000);
        }
        
        function filterProperties(properties, filters) {
            console.log('üîç Iniciando filtrado de', properties.length, 'propiedades');
            console.log('üéõÔ∏è Filtros aplicados:', filters);
            
            const filtered = properties.filter(property => {
                // Filtro por ubicaci√≥n - solo aplicar si hay texto de b√∫squeda
                if (filters.location && filters.location.trim() !== '') {
                    const searchLocation = filters.location.toLowerCase().trim();
                    const propertyLocation = (property.ubi || '').toLowerCase();
                    if (!propertyLocation.includes(searchLocation)) {
                        return false;
                    }
                }
                
                // Filtro por precio m√≠nimo - solo aplicar si se especifica un valor
                if (filters.priceMin !== null && !isNaN(filters.priceMin) && filters.priceMin > 0) {
                    const propertyPrice = parseFloat(property.price) || 0;
                    // Solo filtrar si la propiedad tiene precio y es menor al m√≠nimo
                    if (propertyPrice > 0 && propertyPrice < filters.priceMin) {
                        console.log(`‚ùå Propiedad rechazada por precio m√≠nimo: ${propertyPrice} < ${filters.priceMin}`);
                        return false;
                    }
                }
                
                // Filtro por precio m√°ximo - solo aplicar si se especifica un valor
                if (filters.priceMax !== null && !isNaN(filters.priceMax) && filters.priceMax > 0) {
                    const propertyPrice = parseFloat(property.price) || 0;
                    // Solo filtrar si la propiedad tiene precio y es mayor al m√°ximo
                    if (propertyPrice > 0 && propertyPrice > filters.priceMax) {
                        console.log(`‚ùå Propiedad rechazada por precio m√°ximo: ${propertyPrice} > ${filters.priceMax}`);
                        return false;
                    }
                }
                
                // (Dormitorios, ba√±os y tama√±o deshabilitados)
                if (filters.minSize !== null && !isNaN(filters.minSize) && filters.minSize > 0) {
                    const propertySize = parseInt(property.tama√±o) || parseInt(property.construido) || 0;
                    // Solo filtrar si la propiedad tiene datos de tama√±o y es menor al m√≠nimo
                    if (propertySize > 0 && propertySize < filters.minSize) {
                        console.log(`‚ùå Propiedad rechazada por tama√±o m√≠nimo: ${propertySize} < ${filters.minSize}`);
                        return false;
                    }
                }
                
                // Filtro por tama√±o m√°ximo - solo aplicar si se especifica
                if (filters.maxSize !== null && !isNaN(filters.maxSize) && filters.maxSize > 0) {
                    const propertySize = parseInt(property.tama√±o) || parseInt(property.construido) || 0;
                    // Solo filtrar si la propiedad tiene datos de tama√±o y es mayor al m√°ximo
                    if (propertySize > 0 && propertySize > filters.maxSize) {
                        console.log(`‚ùå Propiedad rechazada por tama√±o m√°ximo: ${propertySize} > ${filters.maxSize}`);
                        return false;
                    }
                }
                
                console.log(`‚úÖ Propiedad aprobada: ${property.name || property.id || 'Sin nombre'}`);
                return true;
            });
            
            console.log('‚úÖ Propiedades que pasaron el filtro:', filtered.length);
            return filtered;
        }
        
        function displayFilteredProperties(properties) {
            console.log('üè† INICIANDO displayFilteredProperties con', properties.length, 'propiedades');
            console.log('üìã Propiedades recibidas:', properties.map((p, i) => `${i}: ${p.name || p.id || 'Sin nombre'}`));
            
            const container = document.getElementById('properties-container');
            const paginationContainer = document.getElementById('pagination-container');
            
            if (!container) {
                console.error('‚ùå No se encontr√≥ el contenedor properties-container');
                return;
            }
            
            // Limpiar contenedores
            container.innerHTML = '';
            if (paginationContainer) {
                paginationContainer.innerHTML = '';
            }
            
            if (properties.length === 0) {
                console.log('‚ùå No hay propiedades para mostrar');
                container.innerHTML = `
                    <div class="property-card">
                        <div class="no-image" style="padding: 40px; text-align: center; color: var(--text-gray);">
                            <h3 style="margin-bottom: 10px; color: var(--dark-turquoise);">Sin resultados</h3>
                            <p>No se encontraron propiedades que coincidan con los criterios seleccionados.</p>
                            <p style="margin-top: 10px; font-size: 0.9em; opacity: 0.8;">Intenta ajustar los filtros para obtener m√°s resultados.</p>
                        </div>
                    </div>
                `;
                return;
            }
            
            console.log('üîÑ Iniciando bucle para procesar', properties.length, 'propiedades');
            
            // Usar un bucle for tradicional en lugar de forEach para mejor control de errores
            for (let index = 0; index < properties.length; index++) {
                const property = properties[index];
                try {
                    console.log(`üîÑ Procesando propiedad ${index + 1}/${properties.length}:`, property.name || property.id || 'Sin nombre');
                    
                    const propertyCard = document.createElement('div');
                    propertyCard.className = 'property-card';
                    
                    // Encontrar el √≠ndice global de la propiedad en allProperties
                    const globalIndex = allProperties.findIndex(p => p.id === property.id || 
                        (p.name === property.name && p.ubi === property.ubi && p.price === property.price));
                    
                    // Manejo de valores nulos
                    const title = property.name ? 
                        (property.name.split('\n')[0] || 'Luxury Property') : 
                        'Luxury Property';
                        
                    const location = property.ubi || 'Prime Location';
                    const price = property.price ? 
                        `${property.price.toLocaleString('en-US', {minimumFractionDigits: 0})}` : 
                        'Price upon request';
                    
                    // Obtener descripci√≥n limitada a 2 p√°rrafos (sin la primera l√≠nea que es el t√≠tulo)
                    let descriptionText = '';
                    if (property.description) {
                        const descLines = property.description.split('\n');
                        // Si hay m√°s de una l√≠nea, tomar desde la segunda; si no, usar toda la descripci√≥n
                        let fullDesc = descLines.length > 1 ? descLines.slice(1).join('\n') : descLines.join('\n');
                        
                        // Dividir por p√°rrafos (doble salto de l√≠nea) o por saltos de l√≠nea simples
                        const paragraphs = fullDesc.split(/\n\n+/).filter(p => p.trim() !== '');
                        if (paragraphs.length === 0) {
                            // Si no hay p√°rrafos por doble salto, dividir por saltos simples
                            const lines = fullDesc.split('\n').filter(l => l.trim() !== '');
                            descriptionText = lines.slice(0, 2).join('\n');
                        } else {
                            // Tomar solo los dos primeros p√°rrafos
                            descriptionText = paragraphs.slice(0, 2).join('\n\n');
                        }
                    }
                    // Si est√° vac√≠o, usar texto por defecto
                    if (!descriptionText || descriptionText.trim() === '') {
                        descriptionText = 'Exceptional property with premium features and finishes in a highly desirable location.';
                    }
                        
                    const features = property.description ? 
                        property.description.split('\n').slice(1, 4) : [
                            'Premium quality construction and materials',
                            'Excellent location with convenient access',
                            'Thoughtfully designed living spaces'
                        ];
                    
                    // Manejo de im√°genes desde el array JSON con try-catch
                    let imagesHTML = '';
                    let indicatorsHTML = '';
                    let hasImages = false;
                    
                    try {
                        if (property.imagenes) {
                            let imagesArray = [];
                            
                            // Caso 1: Es un string que parece una URL
                            if (typeof property.imagenes === 'string' && 
                                (property.imagenes.startsWith('http') || property.imagenes.startsWith('/'))) {
                                imagesArray = [property.imagenes];
                                hasImages = true;
                            }
                            // Caso 2: Es un string JSON
                            else if (typeof property.imagenes === 'string') {
                                try {
                                    const parsed = JSON.parse(property.imagenes);
                                    if (Array.isArray(parsed)) {
                                        imagesArray = parsed;
                                        hasImages = true;
                                    }
                                } catch (jsonError) {
                                    // Si falla el JSON, tratar como URL simple
                                    imagesArray = [property.imagenes];
                                    hasImages = true;
                                }
                            }
                            // Caso 3: Ya es un array
                            else if (Array.isArray(property.imagenes) && property.imagenes.length > 0) {
                                imagesArray = property.imagenes;
                                hasImages = true;
                            }
                            
                            // Generar HTML si tenemos im√°genes v√°lidas
                            if (hasImages && imagesArray.length > 0 && imagesArray[0]) {
                                imagesHTML = imagesArray.map((img, idx) => `
                                    <img src="${img}" class="carousel-image ${idx === 0 ? 'active' : ''}" alt="Property image ${idx + 1}" 
                                         onerror="this.style.display='none';">
                                `).join('');
                                
                                indicatorsHTML = imagesArray.map((img, idx) => `
                                    <div class="indicator ${idx === 0 ? 'active' : ''}" data-index="${idx}"></div>
                                `).join('');
                            } else {
                                hasImages = false;
                            }
                        }
                    } catch (imageError) {
                        console.warn(`‚ö†Ô∏è Error procesando im√°genes para propiedad ${index}:`, imageError);
                        hasImages = false;
                    }
                
                // Generar HTML de la propiedad
                propertyCard.innerHTML = `
                    <div class="property-image-container">
                        <div class="image-carousel">
                            ${hasImages ? 
                                imagesHTML : 
                                '<div class="no-image" style="display: flex; align-items: center; justify-content: center; height: 100%; background: linear-gradient(135deg, var(--light-blue) 0%, var(--white) 100%); color: var(--text-gray);">Property Image Coming Soon</div>'
                            }
                            ${hasImages ? `
                                <div class="carousel-nav">
                                    <button class="carousel-btn prev">‚Äπ</button>
                                    <button class="carousel-btn next">‚Ä∫</button>
                                </div>
                                <div class="carousel-indicators">
                                    ${indicatorsHTML}
                                </div>
                            ` : ''}
                        </div>
                    </div>
                    
                    <div class="property-details-container">
                        <h2 class="property-title" data-i18n-prop="title" style="margin: 0 0 10px 0;">${title}</h2>
                        <div class="property-location">${location}</div>
                        <p class="property-description" data-i18n-prop="description" style="margin-top: 8px; margin-bottom: 12px;">${descriptionText.replace(/\n/g, '<br>')}</p>
                        <ul class="property-features" data-i18n-prop="features">
                            ${features.map(feature => `<li>${feature}</li>`).join('')}
                        </ul>
                        <div class="property-details">
                            ${property.habitaciones ? `<span class="detail-item">${property.habitaciones} Beds</span>` : '<span class="detail-item">3+ Beds</span>'}
                            ${property.ba√±os ? `<span class="detail-item">${property.ba√±os} Baths</span>` : '<span class="detail-item">2+ Baths</span>'}
                            ${property.tama√±o ? `<span class="detail-item">${property.tama√±o} m¬≤ Total</span>` : '<span class="detail-item">250+ m¬≤ Total</span>'}
                            ${property.construido ? `<span class="detail-item">${property.construido} m¬≤ Built</span>` : '<span class="detail-item">180+ m¬≤ Built</span>'}
                            ${property.terraza ? `<span class="detail-item">${property.terraza} m¬≤ Terraces</span>` : '<span class="detail-item">70+ m¬≤ Terraces</span>'}
                        </div>
                        <div class="bottom-row">
                            <div class="property-price">${price}</div>
                            <a href="casas.html?id=${globalIndex >= 0 ? globalIndex : index}" class="view-details" style="width:auto;">View Details</a>
                        </div>
                    </div>
                `;
                
                    container.appendChild(propertyCard);
                    console.log(`‚úÖ Propiedad ${index + 1}/${properties.length} agregada: ${title}`);
                    
                    // Inicializar carrusel si hay im√°genes
                    if (hasImages) {
                        try {
                            initCarousel(propertyCard);
                        } catch (carouselError) {
                            console.warn(`‚ö†Ô∏è Error inicializando carrusel para propiedad ${index}:`, carouselError);
                        }
                    }
                    
                } catch (error) {
                    console.error(`‚ùå Error procesando propiedad ${index + 1}:`, error);
                    console.error('Propiedad que caus√≥ el error:', property);
                    
                    // Crear una tarjeta de error para no interrumpir el flujo
                    const errorCard = document.createElement('div');
                    errorCard.className = 'property-card';
                    errorCard.innerHTML = `
                        <div class="property-details-container">
                            <h1 class="property-title">Error al cargar propiedad</h1>
                            <p class="property-description">Hubo un problema al mostrar esta propiedad. Por favor, contacta al administrador.</p>
                        </div>
                    `;
                    container.appendChild(errorCard);
                }
            }
            
            console.log(`üéØ Total de propiedades mostradas: ${container.children.length}`);
        }
        
        // Funci√≥n alternativa m√°s simple para mostrar propiedades
        function displayFilteredPropertiesSimple(properties) {
            console.log('üè† FUNCI√ìN SIMPLE: Mostrando', properties.length, 'propiedades');
            
            const container = document.getElementById('properties-container');
            const paginationContainer = document.getElementById('pagination-container');
            
            if (!container) {
                console.error('‚ùå No se encontr√≥ el contenedor');
                return;
            }
            
            // Limpiar contenedores
            container.innerHTML = '';
            if (paginationContainer) {
                paginationContainer.innerHTML = '';
            }
            
            if (properties.length === 0) {
                container.innerHTML = `
                    <div class="property-card">
                        <div style="padding: 40px; text-align: center; color: var(--text-gray);">
                            <h3 style="margin-bottom: 10px; color: var(--dark-turquoise);">Sin resultados</h3>
                            <p>No se encontraron propiedades que coincidan con los criterios seleccionados.</p>
                        </div>
                    </div>
                `;
                return;
            }
            
            // Generar HTML de todas las propiedades de una vez
            let allPropertiesHTML = '';
            
            properties.forEach((property, index) => {
                try {
                    const title = property.name ? 
                        (property.name.split('\n')[0] || 'Luxury Property') : 
                        'Luxury Property';
                    const location = property.ubi || 'Prime Location';
                    const price = property.price ? 
                        `${property.price.toLocaleString('en-US', {minimumFractionDigits: 0})}` : 
                        'Price upon request';
                    const description = property.description || 'Exceptional property with premium features.';
                    
                    // Encontrar √≠ndice global
                    const globalIndex = allProperties.findIndex(p => p.id === property.id || 
                        (p.name === property.name && p.ubi === property.ubi && p.price === property.price));
                    
                    // Procesamiento inteligente de im√°genes
                    let imageHTML = '';
                    let hasImages = false;
                    
                    try {
                        if (property.imagenes) {
                            let imagesArray = [];
                            
                            // Caso 1: Es un string que parece una URL
                            if (typeof property.imagenes === 'string' && 
                                (property.imagenes.startsWith('http') || property.imagenes.startsWith('/'))) {
                                imagesArray = [property.imagenes];
                                console.log(`üì∏ Imagen URL detectada para ${title}:`, property.imagenes);
                            }
                            // Caso 2: Es un string JSON
                            else if (typeof property.imagenes === 'string') {
                                try {
                                    const parsed = JSON.parse(property.imagenes);
                                    if (Array.isArray(parsed)) {
                                        imagesArray = parsed;
                                        console.log(`üì∏ Array JSON detectado para ${title}:`, parsed.length, 'im√°genes');
                                    }
                                } catch (jsonError) {
                                    console.warn(`‚ö†Ô∏è Error parseando JSON de im√°genes para ${title}:`, jsonError);
                                    // Si falla el JSON, tratar como URL simple
                                    imagesArray = [property.imagenes];
                                }
                            }
                            // Caso 3: Ya es un array
                            else if (Array.isArray(property.imagenes)) {
                                imagesArray = property.imagenes;
                                console.log(`üì∏ Array directo detectado para ${title}:`, imagesArray.length, 'im√°genes');
                            }
                            
                            // Generar HTML si tenemos im√°genes v√°lidas
                            if (imagesArray.length > 0 && imagesArray[0]) {
                                hasImages = true;
                                const firstImage = imagesArray[0];
                                imageHTML = `
                                    <div class="image-carousel">
                                        <img src="${firstImage}" class="carousel-image active" alt="Property image" 
                                             onerror="this.style.display='none'; this.nextElementSibling.style.display='flex';">
                                        <div class="no-image" style="display: none; align-items: center; justify-content: center; height: 100%; background: linear-gradient(135deg, var(--light-turquoise) 0%, var(--white) 100%); color: var(--text-gray);">
                                            Property Image Coming Soon
                                        </div>
                                        ${imagesArray.length > 1 ? `
                                            <div class="carousel-nav">
                                                <button class="carousel-btn prev" onclick="prevImage(this)">‚Äπ</button>
                                                <button class="carousel-btn next" onclick="nextImage(this)">‚Ä∫</button>
                                            </div>
                                            <div class="carousel-indicators">
                                                ${imagesArray.map((_, idx) => `
                                                    <div class="indicator ${idx === 0 ? 'active' : ''}" data-index="${idx}" onclick="showImage(this, ${idx})"></div>
                                                `).join('')}
                                            </div>
                                        ` : ''}
                                    </div>
                                `;
                            }
                        }
                    } catch (imageError) {
                        console.warn(`‚ö†Ô∏è Error procesando im√°genes para ${title}:`, imageError);
                        hasImages = false;
                    }
                    
                    // Si no hay im√°genes v√°lidas, usar placeholder
                    if (!hasImages) {
                        imageHTML = `
                            <div class="image-carousel">
                                <div class="no-image" style="display: flex; align-items: center; justify-content: center; height: 100%; background: linear-gradient(135deg, var(--light-turquoise) 0%, var(--white) 100%); color: var(--text-gray);">
                                    Property Image Coming Soon
                                </div>
                            </div>
                        `;
                    }
                    
                    allPropertiesHTML += `
                        <div class="property-card">
                            <div class="property-image-container">
                                ${imageHTML}
                            </div>
                            <div class="property-details-container">
                                <h1 class="property-title" data-i18n-prop="title">${title}</h1>
                                <div class="property-location">${location}</div>
                                <p class="property-description" data-i18n-prop="description">${description.replace(/\n/g, '<br>')}</p>
                                <div class="property-details">
                                    <span class="detail-item">${property.habitaciones || '3+'} Bedrooms</span>
                                    <span class="detail-item">${property.ba√±os || '2+'} Baths</span>
                                    <span class="detail-item">${property.tama√±o || '250+'} m¬≤ Total</span>
                                </div>
                                <div class="bottom-row">
                                    <div class="property-price">${price}</div>
                                    <a href="casas.html?id=${globalIndex >= 0 ? globalIndex : index}" class="view-details" style="width:auto;">View Details</a>
                                </div>
                            </div>
                        </div>
                    `;
                    
                    console.log(`‚úÖ HTML generado para propiedad ${index + 1}: ${title}`);
                } catch (error) {
                    console.error(`‚ùå Error generando HTML para propiedad ${index}:`, error);
                }
            });
            
            // Insertar todo el HTML de una vez
            container.innerHTML = allPropertiesHTML;
            console.log(`üéØ HTML insertado. Total elementos en container: ${container.children.length}`);
            
            // Traducir contenido din√°mico despu√©s de mostrar las propiedades
            setTimeout(async () => {
                try {
                    await translateDynamicProperties();
                } catch (error) {
                    console.error('Error en traducci√≥n din√°mica:', error);
                }
            }, 200);
        }
        
        // Funciones simples para el carrusel de im√°genes
        function nextImage(button) {
            const carousel = button.closest('.image-carousel');
            const images = carousel.querySelectorAll('.carousel-image');
            const indicators = carousel.querySelectorAll('.indicator');
            
            let currentIndex = Array.from(images).findIndex(img => img.classList.contains('active'));
            let nextIndex = (currentIndex + 1) % images.length;
            
            // Cambiar imagen activa
            images[currentIndex].classList.remove('active');
            images[nextIndex].classList.add('active');
            
            // Cambiar indicador activo
            if (indicators.length > 0) {
                indicators[currentIndex].classList.remove('active');
                indicators[nextIndex].classList.add('active');
            }
        }
        
        function prevImage(button) {
            const carousel = button.closest('.image-carousel');
            const images = carousel.querySelectorAll('.carousel-image');
            const indicators = carousel.querySelectorAll('.indicator');
            
            let currentIndex = Array.from(images).findIndex(img => img.classList.contains('active'));
            let prevIndex = (currentIndex - 1 + images.length) % images.length;
            
            // Cambiar imagen activa
            images[currentIndex].classList.remove('active');
            images[prevIndex].classList.add('active');
            
            // Cambiar indicador activo
            if (indicators.length > 0) {
                indicators[currentIndex].classList.remove('active');
                indicators[prevIndex].classList.add('active');
            }
        }
        
        function showImage(indicator, targetIndex) {
            const carousel = indicator.closest('.image-carousel');
            const images = carousel.querySelectorAll('.carousel-image');
            const indicators = carousel.querySelectorAll('.indicator');
            
            // Remover todas las clases activas
            images.forEach(img => img.classList.remove('active'));
            indicators.forEach(ind => ind.classList.remove('active'));
            
            // Activar la imagen e indicador objetivo
            if (images[targetIndex]) {
                images[targetIndex].classList.add('active');
            }
            if (indicators[targetIndex]) {
                indicators[targetIndex].classList.add('active');
            }
        }
        
        async function clearFilters() {
            // Limpiar todos los campos de filtros
            const locationEl = document.getElementById('location-search');
            const minPriceEl = document.getElementById('price-min');
            const maxPriceEl = document.getElementById('price-max');
            
            
            // Limpiar valores
            if (locationEl) locationEl.value = '';
            if (minPriceEl) minPriceEl.value = '';
            if (maxPriceEl) maxPriceEl.value = '';
            
            
            // Resetear filtros globales
            currentFilters = {
                location: '',
                priceMin: null,
                priceMax: null,
                requirements: '',
                aiAnalysis: null
            };
            
            // Restaurar visualizaci√≥n original de todas las propiedades
            await updatePropertiesDisplay();
        }
        
        // Funci√≥n para toggle de filtros (funciona en m√≥vil y desktop)
        function toggleFilters() {
            const filtersContent = document.getElementById('filters-content');
            const toggleIcon = document.getElementById('toggle-icon');
            
            // Detectar si estamos en m√≥vil o m√≥vil horizontal
            const isMobile = window.innerWidth <= 767;
            const isMobileLandscape = window.innerWidth <= 1024 && window.matchMedia('(orientation: landscape)').matches;
            
            if (isMobile || isMobileLandscape) {
                // En m√≥vil o m√≥vil horizontal, mostrar/ocultar el contenido del desplegable
                if (filtersContent.classList.contains('show')) {
                    filtersContent.classList.remove('show');
                    toggleIcon.textContent = '‚ñº';
                } else {
                    filtersContent.classList.add('show');
                    toggleIcon.textContent = '‚ñ≤';
                }
            } else {
                // En desktop, colapsar/expandir solo el contenido
                if (filtersContent.classList.contains('collapsed')) {
                    filtersContent.classList.remove('collapsed');
                    toggleIcon.textContent = '‚ñº';
                } else {
                    filtersContent.classList.add('collapsed');
                    toggleIcon.textContent = '‚ñ∂';
                }
            }
        }
        
        // Inicializar todas las funcionalidades
        function initFilterSystem() {
            initLocationSearch();
            initFilterActions();
            
            // Colapsar filtros por defecto en m√≥vil
            if (window.innerWidth <= 767) {
                const filtersContent = document.getElementById('filters-content');
                const toggleIcon = document.getElementById('toggle-icon');
                filtersContent.classList.remove('show');
                toggleIcon.textContent = '‚ñº';
            }
        }
        
        // Funci√≥n de traducci√≥n autom√°tica
        function hashCode(str) { 
            let h = 0, i = 0, len = str.length; 
            while(i < len) { 
                h = (h << 5) - h + str.charCodeAt(i++) | 0; 
            } 
            return h.toString(); 
        }
        
        // Funci√≥n para buscar en el backup de traducciones almacenadas
        function searchTranslationBackup(text, to) {
            try {
                // Buscar todas las claves de traducci√≥n en localStorage
                const backupPrefix = 'mbi_mt_' + to + '_';
                const textLower = text.trim().toLowerCase();
                
                // Buscar traducciones exactas o similares
                for (let i = 0; i < localStorage.length; i++) {
                    const storageKey = localStorage.key(i);
                    if (storageKey && storageKey.startsWith(backupPrefix)) {
                        // Extraer el texto original del hash (aproximaci√≥n)
                        // Buscar traducciones que contengan palabras similares
                        const translatedValue = localStorage.getItem(storageKey);
                        if (translatedValue) {
                            // Buscar si hay una traducci√≥n para un texto similar
                            // Comparar palabras clave del texto
                            const textWords = textLower.split(/\s+/).filter(w => w.length > 3);
                            if (textWords.length > 0) {
                                // Si el texto es muy corto, buscar coincidencia exacta
                                if (text.length < 20) {
                                    // Intentar encontrar traducciones guardadas para textos similares
                                    // Esto es una aproximaci√≥n - buscar en todas las traducciones guardadas
                                }
                            }
                        }
                    }
                }
                
                // Buscar en el diccionario de backup si existe
                const backupKey = 'mbi_translation_backup';
                const backupDict = localStorage.getItem(backupKey);
                if (backupDict) {
                    try {
                        const backup = JSON.parse(backupDict);
                        const textKey = text.trim().toLowerCase();
                        if (backup[to] && backup[to][textKey]) {
                            return backup[to][textKey];
                        }
                        // Buscar coincidencias parciales
                        if (backup[to]) {
                            for (const [key, value] of Object.entries(backup[to])) {
                                if (key.includes(textKey) || textKey.includes(key)) {
                                    return value;
                                }
                            }
                        }
                    } catch (e) {
                        console.warn('Error parsing backup dictionary:', e);
                    }
                }
            } catch (error) {
                console.warn('Error searching translation backup:', error);
            }
            return null;
        }
        
        async function mtTranslate(text, to) {
            if (!text) return text;
            const key = 'mbi_mt_' + to + '_' + hashCode(text);
            const cached = localStorage.getItem(key); 
            if (cached) return cached;
            
            // Mapeo de c√≥digos de idioma para DeepL
            const deeplLangMap = { 'en': 'EN', 'es': 'ES', 'fr': 'FR', 'de': 'DE' };
            const deeplTo = deeplLangMap[to] || 'EN';
            
            // Intentar primero con MyMemory (API principal)
            const candidates = ['en', 'es', 'fr', 'de'].filter(s => s !== to);
            let best = { out: text, score: -1 };
            let mymemoryFailed = false;
            
            for (const src of candidates) {
                try {
                    const url = 'https://api.mymemory.translated.net/get?q=' + encodeURIComponent(text) + '&langpair=' + encodeURIComponent(src + '|' + to);
                    const res = await fetch(url);
                    const json = await res.json();
                    
                    // Verificar si hay un warning o error en la respuesta
                    if (json.responseStatus && json.responseStatus !== 200) {
                        mymemoryFailed = true;
                        break;
                    }
                    
                    // Verificar si la respuesta contiene un warning (como l√≠mite de uso)
                    const translatedText = json.responseData && json.responseData.translatedText;
                    if (!translatedText || translatedText.includes('MYMEMORY WARNING') || translatedText.includes('QUOTA EXCEEDED')) {
                        mymemoryFailed = true;
                        break;
                    }
                    
                    // Verificar si la traducci√≥n es v√°lida (no es igual al texto original)
                    if (translatedText.trim().toLowerCase() === text.trim().toLowerCase()) {
                        continue; // No se tradujo, intentar siguiente candidato
                    }
                    
                    const out = translatedText;
                    const score = (json && Array.isArray(json.matches) && json.matches.length) ? Math.max(...json.matches.map(m => Number(m.match) || 0)) : (Number(json.responseData.match) || 0);
                    if (score > best.score) { best = { out, score }; }
                    if (best.score >= 0.9) {
                        localStorage.setItem(key, best.out);
                        return best.out; // Resultado suficientemente bueno
                    }
                } catch (error) {
                    console.warn('MyMemory request failed:', error);
                    mymemoryFailed = true;
                    break;
                }
            }
            
            // Si MyMemory fall√≥, buscar primero en el backup de traducciones
            if (mymemoryFailed) {
                const backupTranslation = searchTranslationBackup(text, to);
                if (backupTranslation) {
                    localStorage.setItem(key, backupTranslation);
                    return backupTranslation;
                }
            }
            
            // Si MyMemory fall√≥ o no dio buen resultado, usar DeepL como fallback
            if (mymemoryFailed || best.score < 0.9) {
                try {
                    const deeplUrl = 'https://api-free.deepl.com/v2/translate';
                    const deeplRes = await fetch(deeplUrl, {
                        method: 'POST',
                        headers: {
                            'Authorization': 'DeepL-Auth-Key ad4ace5f-5951-4b5d-83c1-8079d77defcd:fx',
                            'Content-Type': 'application/x-www-form-urlencoded',
                        },
                        body: new URLSearchParams({
                            'text': text,
                            'target_lang': deeplTo
                        })
                    });
                    
                    if (deeplRes.ok) {
                        const deeplJson = await deeplRes.json();
                        if (deeplJson && deeplJson.translations && deeplJson.translations.length > 0) {
                            const deeplOut = deeplJson.translations[0].text;
                            if (deeplOut && deeplOut.trim()) {
                                localStorage.setItem(key, deeplOut);
                                return deeplOut;
                            }
                        }
                    }
                } catch (deeplError) {
                    console.warn('DeepL fallback failed:', deeplError);
                }
            }
            
            // Si todo falla, usar el mejor resultado de MyMemory o el texto original
            localStorage.setItem(key, best.out);
            return best.out;
        }

        // Variable para evitar m√∫ltiples ejecuciones simult√°neas
        let isTranslating = false;
        
        // Funci√≥n para traducir contenido din√°mico de propiedades
        async function translateDynamicProperties() {
            // Evitar m√∫ltiples ejecuciones simult√°neas
            if (isTranslating) {
                console.log('‚è≥ Traducci√≥n ya en progreso, esperando...');
                return;
            }
            
            const lang = localStorage.getItem('mbi_lang') || 'en';
            if (lang === 'en') {
                console.log('‚ÑπÔ∏è Idioma es ingl√©s, no se necesita traducci√≥n');
                return;
            }
            
            isTranslating = true;
            console.log(`üîÑ Iniciando traducci√≥n de propiedades al idioma: ${lang}`);
            
            // Verificar que el contenedor existe
            const container = document.getElementById('properties-container');
            console.log('üîç Contenedor properties-container:', container ? 'encontrado' : 'NO encontrado');
            if (container) {
                console.log('üîç Elementos en contenedor:', container.children.length);
                // Verificar si hay elementos con las clases correctas
                const allTitles = container.querySelectorAll('.property-title');
                const allDescriptions = container.querySelectorAll('.property-description');
                console.log('üîç Total .property-title en contenedor:', allTitles.length);
                console.log('üîç Total .property-description en contenedor:', allDescriptions.length);
                if (allTitles.length > 0) {
                    console.log('üîç Primer t√≠tulo encontrado:', allTitles[0]);
                    console.log('üîç Atributos del primer t√≠tulo:', allTitles[0].getAttribute('data-i18n-prop'));
                }
            }
            
            try {
                // Buscar en todo el documento, no solo en un contenedor espec√≠fico
                const allTitlesInDoc = document.querySelectorAll('.property-title');
                const titlesWithAttr = document.querySelectorAll('.property-title[data-i18n-prop="title"]');
                console.log(`üîç Total .property-title en documento: ${allTitlesInDoc.length}`);
                console.log(`üîç Total .property-title[data-i18n-prop="title"]: ${titlesWithAttr.length}`);
                
                // Traducir t√≠tulos de propiedades
                const titles = [...document.querySelectorAll('.property-title[data-i18n-prop="title"]')];
                console.log(`üìù Encontrados ${titles.length} t√≠tulos para traducir`);
                for (let i = 0; i < titles.length; i++) {
                    const el = titles[i];
                    const originalText = el.textContent.trim();
                    if (originalText) {
                        try {
                            console.log(`üîÑ Traduciendo t√≠tulo ${i + 1}/${titles.length}: "${originalText.substring(0, 50)}..."`);
                            const translated = await mtTranslate(originalText, lang);
                            console.log(`üì• Resultado de traducci√≥n:`, translated ? `"${translated.substring(0, 50)}..."` : 'null/undefined');
                            if (translated && translated.trim() && translated !== originalText) {
                                el.textContent = translated;
                                console.log(`‚úÖ T√≠tulo ${i + 1} traducido: "${originalText.substring(0, 30)}..." -> "${translated.substring(0, 30)}..."`);
                            } else {
                                console.warn(`‚ö†Ô∏è T√≠tulo ${i + 1} no se tradujo (mismo texto o vac√≠o)`);
                            }
                        } catch (err) {
                            console.error(`‚ùå Error traduciendo t√≠tulo ${i + 1}:`, err);
                        }
                    }
                }
                
                // Traducir descripciones de propiedades
                const allDescriptionsInDoc = document.querySelectorAll('.property-description');
                const descriptionsWithAttr = document.querySelectorAll('.property-description[data-i18n-prop="description"]');
                console.log(`üîç Total .property-description en documento: ${allDescriptionsInDoc.length}`);
                console.log(`üîç Total .property-description[data-i18n-prop="description"]: ${descriptionsWithAttr.length}`);
                
                const descriptions = [...document.querySelectorAll('.property-description[data-i18n-prop="description"]')];
                console.log(`üìÑ Encontradas ${descriptions.length} descripciones para traducir`);
                for (let i = 0; i < descriptions.length; i++) {
                    const el = descriptions[i];
                    // Obtener el texto sin HTML, pero preservar los saltos de l√≠nea
                    const originalText = el.textContent.trim() || el.innerText.trim();
                    if (originalText) {
                        try {
                            console.log(`üîÑ Traduciendo descripci√≥n ${i + 1}/${descriptions.length}: "${originalText.substring(0, 50)}..."`);
                            const translated = await mtTranslate(originalText, lang);
                            console.log(`üì• Resultado de traducci√≥n:`, translated ? `"${translated.substring(0, 50)}..."` : 'null/undefined');
                            if (translated && translated.trim() && translated !== originalText) {
                                // Reemplazar saltos de l√≠nea con <br> para mantener el formato
                                el.innerHTML = translated.replace(/\n/g, '<br>');
                                console.log(`‚úÖ Descripci√≥n ${i + 1} traducida: "${originalText.substring(0, 30)}..." -> "${translated.substring(0, 30)}..."`);
                            } else {
                                console.warn(`‚ö†Ô∏è Descripci√≥n ${i + 1} no se tradujo (mismo texto o vac√≠o)`);
                            }
                        } catch (err) {
                            console.error(`‚ùå Error traduciendo descripci√≥n ${i + 1}:`, err);
                        }
                    }
                }
                
                // Traducir caracter√≠sticas de propiedades
                const features = [...document.querySelectorAll('.property-features[data-i18n-prop="features"] li')];
                console.log(`‚ú® Encontradas ${features.length} caracter√≠sticas para traducir`);
                for (let i = 0; i < features.length; i++) {
                    const el = features[i];
                    const originalText = el.textContent.trim();
                    if (originalText) {
                        try {
                            const translated = await mtTranslate(originalText, lang);
                            if (translated && translated.trim() && translated !== originalText) {
                                el.textContent = translated;
                                console.log(`‚úÖ Caracter√≠stica ${i + 1} traducida: "${originalText}" -> "${translated}"`);
                            }
                        } catch (err) {
                            console.warn(`‚ö†Ô∏è Error traduciendo caracter√≠stica ${i + 1}:`, err);
                        }
                    }
                }
                
                console.log('‚úÖ Propiedades traducidas din√°micamente');
            } catch (error) {
                console.error('‚ùå Error en traducci√≥n din√°mica de propiedades:', error);
            } finally {
                isTranslating = false;
            }
        }

        // Detecci√≥n de m√≥vil y configuraci√≥n de URLs
        function isMobile() {
            return /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);
        }

        function getAPIURL() {
            // Usar la misma API base que el resto de la aplicaci√≥n
            return window.location.origin + '/api';
        }

        // Funci√≥n mejorada para cargar propiedades con fallback para m√≥viles
        // Funci√≥n para probar m√∫ltiples URLs con soporte para m√≥vil
        async function tryFetch(url, options = {}) {
            try {
                // Configuraci√≥n espec√≠fica para m√≥viles (manejo de SSL)
                const fetchOptions = {
                    ...options,
                    mode: 'cors',
                    credentials: 'omit',
                    headers: {
                        'Accept': 'application/json',
                        'Content-Type': 'application/json',
                        ...options.headers
                    }
                };
                
                const response = await fetch(url, fetchOptions);
                if (response.ok) {
                    return response;
                }
                throw new Error(`HTTP ${response.status}`);
            } catch (error) {
                // Manejar errores espec√≠ficos de m√≥vil
                if (error.message.includes('ERR_CERT') || error.message.includes('SSL') || error.message.includes('TLS')) {
                    throw new Error('SSL Certificate Error');
                }
                if (error.message.includes('ERR_CONNECTION_REFUSED')) {
                    throw new Error('Connection Refused');
                }
                if (error.message.includes('ERR_CONNECTION_TIMED_OUT')) {
                    throw new Error('Connection Timeout');
                }
                throw error;
            }
        }


        document.addEventListener('DOMContentLoaded', function() {
            let currentPage = 1;
            const propertiesPerPage = 10;
            
            // Funci√≥n loadProperties dentro del scope correcto
            async function loadProperties() {
                const urls = [
                    'https://mediterraneanbi.com:3000/data',
                    'https://mediterraneanbi.com:443/data'
                ];
                
                console.log('üîÑ Intentando cargar propiedades...');
                
                for (let i = 0; i < urls.length; i++) {
                    const url = urls[i];
                    console.log(`üîÑ Intento ${i + 1}/3: ${url}`);
                    
                    try {
                        const response = await tryFetch(url);
                        const properties = await response.json();
                        console.log('‚úÖ Propiedades cargadas:', properties.length, 'elementos');
                        allProperties = properties;
                        updatePropertiesDisplay();
                        setupPagination();
                        return; // √âxito, salir de la funci√≥n
                    } catch (error) {
                        console.warn(`‚ö†Ô∏è URL ${i + 1} fall√≥:`, error.message);
                    }
                }
                
                // Si llegamos aqu√≠, todas las URLs fallaron
                console.error('‚ùå Todas las URLs fallaron - usando datos de prueba');
                
                // Usar datos de prueba como fallback
                allProperties = [
                    {
                        id: 1,
                        name: "Villa de Prueba 1",
                        price: 500000,
                        ubi: "Marbella, Espa√±a",
                        description: "Hermosa villa de prueba para testing",
                        imagenes: ["https://via.placeholder.com/400x250?text=Villa+1+Image+1", "https://via.placeholder.com/400x250?text=Villa+1+Image+2"],
                        ba√±os: 4, tama√±o: 500, construido: 300, terraza: 100, aseos: 2, jardin: true, piscina: true
                    },
                    {
                        id: 2,
                        name: "Apartamento de Prueba 2",
                        price: 300000,
                        ubi: "Barcelona, Espa√±a",
                        description: "Moderno apartamento de prueba",
                        imagenes: ["https://via.placeholder.com/400x250?text=Apartment+2+Image+1"],
                        ba√±os: 2, tama√±o: 120, construido: 100, terraza: 20, aseos: 1, jardin: false, piscina: false
                    },
                    {
                        id: 3,
                        name: "Casa de Prueba 3",
                        price: 400000,
                        ubi: "Madrid, Espa√±a",
                        description: "Elegante casa de prueba",
                        imagenes: [],
                        ba√±os: 3, tama√±o: 250, construido: 200, terraza: 50, aseos: 1, jardin: true, piscina: true
                    }
                ];
                
                // Mostrar datos de prueba
                await updatePropertiesDisplay();
                setupPagination();
                
                // Mostrar mensaje de advertencia
                const container = document.getElementById('properties-container');
                const warningDiv = document.createElement('div');
                warningDiv.className = 'property-card';
                warningDiv.style.background = '#fff3cd';
                warningDiv.style.border = '1px solid #ffeaa7';
                warningDiv.innerHTML = `
                    <div style="padding: 20px; text-align: center; color: #856404;">
                        ‚ö†Ô∏è <strong>Modo de Prueba</strong><br>
                        <small>No se pudo conectar al servidor. Mostrando datos de ejemplo.</small>
                    </div>
                `;
                container.insertBefore(warningDiv, container.firstChild);
            }
            
            // Inicializar sistema de filtros
            initFilterSystem();
            
            // Verificar si estamos en la p√°gina de detalles
            console.log('üåê URL actual:', window.location.href);
            console.log('üîç Par√°metros de URL:', window.location.search);
            const urlParams = new URLSearchParams(window.location.search);
            const propertyId = urlParams.get('id');
            
            console.log('üîç Par√°metro ID extra√≠do:', propertyId);
            console.log('üîç Tipo de propertyId:', typeof propertyId);
            
            if (propertyId) {
                console.log('üîç Detectado par√°metro ID en URL:', propertyId);
                console.log('üîç Llamando a showPropertyDetail...');
                showPropertyDetail(propertyId);
                return;
            }
            
            console.log('üîç No se detect√≥ par√°metro ID, cargando lista de propiedades');
            
            // Load properties (igual que casasAdmin)
            loadProperties();
            
            async function updatePropertiesDisplay() {
                const container = document.getElementById('properties-container');
                container.innerHTML = '';
                
                if (allProperties.length === 0) {
                    container.innerHTML = `
                        <div class="property-card">
                            <div class="no-image" style="padding: 40px; text-align: center;">No properties available at the moment</div>
                        </div>
                    `;
                    return;
                }
                
                const startIndex = (currentPage - 1) * propertiesPerPage;
                const endIndex = Math.min(startIndex + propertiesPerPage, allProperties.length);
                const propertiesToShow = allProperties.slice(startIndex, endIndex);
                
                propertiesToShow.forEach((property, index) => {
                    const propertyCard = document.createElement('div');
                    propertyCard.className = 'property-card';
                    
                    // Manejo de valores nulos (igual que displayFilteredProperties)
                    const title = property.name ? 
                        (property.name.split('\n')[0] || 'Luxury Property') : 
                        'Luxury Property';
                        
                    const location = property.ubi || 'Prime Location';
                    const price = property.price ? 
                        `${property.price.toLocaleString('en-US', {minimumFractionDigits: 0})}` : 
                        'Price upon request';
                    
                    // Obtener descripci√≥n limitada a 2 p√°rrafos (sin la primera l√≠nea que es el t√≠tulo)
                    let descriptionText = '';
                    if (property.description) {
                        const descLines = property.description.split('\n');
                        // Si hay m√°s de una l√≠nea, tomar desde la segunda; si no, usar toda la descripci√≥n
                        let fullDesc = descLines.length > 1 ? descLines.slice(1).join('\n') : descLines.join('\n');
                        
                        // Dividir por p√°rrafos (doble salto de l√≠nea) o por saltos de l√≠nea simples
                        const paragraphs = fullDesc.split(/\n\n+/).filter(p => p.trim() !== '');
                        if (paragraphs.length === 0) {
                            // Si no hay p√°rrafos por doble salto, dividir por saltos simples
                            const lines = fullDesc.split('\n').filter(l => l.trim() !== '');
                            descriptionText = lines.slice(0, 2).join('\n');
                        } else {
                            // Tomar solo los dos primeros p√°rrafos
                            descriptionText = paragraphs.slice(0, 2).join('\n\n');
                        }
                    }
                    // Si est√° vac√≠o, usar texto por defecto
                    if (!descriptionText || descriptionText.trim() === '') {
                        descriptionText = 'Exceptional property with premium features and finishes in a highly desirable location.';
                    }
                        
                    const features = property.description ? 
                        property.description.split('\n').slice(1, 4) : [
                            'Premium quality construction and materials',
                            'Excellent location with convenient access',
                            'Thoughtfully designed living spaces'
                        ];
                    
                    // Manejo de im√°genes desde el array JSON
                    let imagesHTML = '';
                    let indicatorsHTML = '';
                    let hasImages = false;
                    
                    if (property.imagenes && property.imagenes.length > 0) {
                        hasImages = true;
                        // Convertir string JSON a array si es necesario
                        const imagesArray = typeof property.imagenes === 'string' ? 
                            JSON.parse(property.imagenes) : property.imagenes;
                        
                        imagesHTML = imagesArray.map((img, idx) => `
                            <img src="${img}" class="carousel-image ${idx === 0 ? 'active' : ''}" alt="Property image ${idx + 1}">
                        `).join('');
                        
                        indicatorsHTML = imagesArray.map((img, idx) => `
                            <div class="indicator ${idx === 0 ? 'active' : ''}" data-index="${idx}"></div>
                        `).join('');
                    }
                    
                    // Generar HTML de la propiedad
                    propertyCard.innerHTML = `
                        <div class="property-image-container">
                            <div class="image-carousel">
                                ${hasImages ? 
                                    imagesHTML : 
                                    '<div class="no-image" style="display: flex; align-items: center; justify-content: center; height: 100%; background: linear-gradient(135deg, var(--light-blue) 0%, var(--white) 100%); color: var(--text-gray);">Property Image Coming Soon</div>'
                                }
                                ${hasImages ? `
                                    <div class="carousel-nav">
                                        <button class="carousel-btn prev">‚Äπ</button>
                                        <button class="carousel-btn next">‚Ä∫</button>
                                    </div>
                                    <div class="carousel-indicators">
                                        ${indicatorsHTML}
                                    </div>
                                ` : ''}
                            </div>
                        </div>
                        
                        <div class="property-details-container">
                            <h1 class="property-title" data-i18n-prop="title">${title}</h1>
                            <div class="property-location">${location}</div>
                            <p class="property-description" data-i18n-prop="description" style="margin-top: 8px; margin-bottom: 12px;">${descriptionText.replace(/\n/g, '<br>')}</p>
                            <ul class="property-features" data-i18n-prop="features">
                                ${features.map(feature => `<li>${feature}</li>`).join('')}
                            </ul>
                            <div class="property-details">
                                ${property.habitaciones ? `<span class="detail-item">${property.habitaciones} Beds</span>` : '<span class="detail-item">3+ Beds</span>'}
                                ${property.ba√±os ? `<span class="detail-item">${property.ba√±os} Baths</span>` : '<span class="detail-item">2+ Baths</span>'}
                                ${property.tama√±o ? `<span class="detail-item">${property.tama√±o} m¬≤ Total</span>` : '<span class="detail-item">250+ m¬≤ Total</span>'}
                                ${property.construido ? `<span class="detail-item">${property.construido} m¬≤ Built</span>` : '<span class="detail-item">180+ m¬≤ Built</span>'}
                                ${property.terraza ? `<span class="detail-item">${property.terraza} m¬≤ Terraces</span>` : '<span class="detail-item">70+ m¬≤ Terraces</span>'}
                            </div>
                            <div class="bottom-row">
                                <div class="property-price">${price}</div>
                                <a href="casas.html?id=${startIndex + index}" class="view-details" style="width:auto;">View Details</a>
                            </div>
                        </div>
                    `;
                    
                    container.appendChild(propertyCard);
                    
                    // Inicializar carrusel si hay im√°genes
                    if (hasImages) {
                        initCarousel(propertyCard);
                    }
                });
                
                // Traducir contenido din√°mico despu√©s de mostrar las propiedades (con peque√±o delay)
                setTimeout(async () => {
                    try {
                        await translateDynamicProperties();
                    } catch (error) {
                        console.error('Error en traducci√≥n din√°mica:', error);
                    }
                }, 200);
            }
            
            function setupPagination() {
                const totalPages = Math.ceil(allProperties.length / propertiesPerPage);
                const paginationContainer = document.getElementById('pagination-container');
                paginationContainer.innerHTML = '';
                
                if (totalPages <= 1) return;
                
                // Bot√≥n Anterior
                const prevBtn = document.createElement('button');
                prevBtn.className = `page-btn ${currentPage === 1 ? 'disabled' : ''}`;
                prevBtn.textContent = 'Previous';
                prevBtn.addEventListener('click', async () => {
                    if (currentPage > 1) {
                        currentPage--;
                        await updatePropertiesDisplay();
                        setupPagination();
                        window.scrollTo({top: 0, behavior: 'smooth'});
                    }
                });
                paginationContainer.appendChild(prevBtn);
                
                // N√∫meros de p√°gina
                for (let i = 1; i <= totalPages; i++) {
                    const pageBtn = document.createElement('button');
                    pageBtn.className = `page-btn ${i === currentPage ? 'active' : ''}`;
                    pageBtn.textContent = i;
                    pageBtn.addEventListener('click', async () => {
                        currentPage = i;
                        await updatePropertiesDisplay();
                        setupPagination();
                        window.scrollTo({top: 0, behavior: 'smooth'});
                    });
                    paginationContainer.appendChild(pageBtn);
                }
                
                // Bot√≥n Siguiente
                const nextBtn = document.createElement('button');
                nextBtn.className = `page-btn ${currentPage === totalPages ? 'disabled' : ''}`;
                nextBtn.textContent = 'Next';
                nextBtn.addEventListener('click', async () => {
                    if (currentPage < totalPages) {
                        currentPage++;
                        await updatePropertiesDisplay();
                        setupPagination();
                        window.scrollTo({top: 0, behavior: 'smooth'});
                    }
                });
                paginationContainer.appendChild(nextBtn);
            }
            
            function initCarousel(propertyCard) {
                const carousel = propertyCard.querySelector('.image-carousel');
                const images = carousel.querySelectorAll('.carousel-image');
                const prevBtn = carousel.querySelector('.prev');
                const nextBtn = carousel.querySelector('.next');
                const indicators = carousel.querySelectorAll('.indicator');
                
                let currentIndex = 0;
                
                function showImage(index) {
                    images.forEach(img => img.classList.remove('active'));
                    indicators.forEach(ind => ind.classList.remove('active'));
                    
                    images[index].classList.add('active');
                    indicators[index].classList.add('active');
                    currentIndex = index;
                }
                
                function nextImage() {
                    currentIndex = (currentIndex + 1) % images.length;
                    showImage(currentIndex);
                }
                
                function prevImage() {
                    currentIndex = (currentIndex - 1 + images.length) % images.length;
                    showImage(currentIndex);
                }
                
                // Event listeners
                if (nextBtn) nextBtn.addEventListener('click', nextImage);
                if (prevBtn) prevBtn.addEventListener('click', prevImage);
                
                indicators.forEach(indicator => {
                    indicator.addEventListener('click', () => {
                        showImage(parseInt(indicator.dataset.index));
                    });
                });
                
                // Auto-rotate (opcional)
                let interval = setInterval(nextImage, 5000);
                
                carousel.addEventListener('mouseenter', () => {
                    clearInterval(interval);
                });
                
                carousel.addEventListener('mouseleave', () => {
                    interval = setInterval(nextImage, 5000);
                });
            }
            
            function showPropertyDetail(propertyId) {
                console.log('üöÄ INICIANDO showPropertyDetail con ID:', propertyId);
                console.log('üîç Mostrando detalles de propiedad ID:', propertyId);
                // Usar la misma API base que el resto de la aplicaci√≥n
                const API_BASE = window.location.origin + '/api';
                console.log('üåê API Base:', API_BASE);
                console.log('üåê Haciendo fetch a:', API_BASE + '/data');
                
                // Test de conectividad b√°sico
                console.log('üîç Probando conectividad...');
                fetch(API_BASE + '/data', {
                    method: 'GET',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    mode: 'cors'
                })
                    .then(response => {
                        console.log('üì° Respuesta recibida:', response.status, response.statusText);
                        if (!response.ok) {
                            throw new Error(`HTTP error! status: ${response.status}`);
                        }
                        return response.json();
                    })
                .then(properties => {
                    console.log('üì¶ Propiedades recibidas:', properties.length);
                    console.log('üîç Buscando propiedad con ID:', propertyId);
                    const property = properties[propertyId];
                    console.log('üè† Propiedad encontrada:', property);
                    if (!property) {
                        document.getElementById('app-content').innerHTML = `
                            <div class="property-detail-container">
                                <a href="casas.html" class="back-button">‚Üê Back to Properties</a>
                                <div class="property-detail-card">
                                    <div class="no-image" style="padding: 40px; text-align: center;">
                                        Property not found
                                    </div>
                                </div>
                            </div>
                        `;
                        return;
                    }
                    
                    // Manejo de valores nulos
                    const title = property.name ? 
                        (property.name.split('\n')[0] || 'Luxury Property') : 
                        'Luxury Property';
                    const name = property.name || 'Luxury Property';
                        
                    const location = property.ubi || 'Prime Location';
                    const price = property.price ? 
                        `‚Ç¨${property.price.toLocaleString('en-US', {minimumFractionDigits: 0})}` : 
                        'Price upon request';
                    
                    // Obtener descripci√≥n completa (sin la primera l√≠nea que es el t√≠tulo)
                    let descriptionText = '';
                    if (property.description) {
                        const descLines = property.description.split('\n');
                        // Si hay m√°s de una l√≠nea, tomar desde la segunda; si no, usar toda la descripci√≥n
                        descriptionText = descLines.length > 1 ? descLines.slice(1).join('\n') : descLines.join('\n');
                    }
                    // Si est√° vac√≠o, usar texto por defecto
                    if (!descriptionText || descriptionText.trim() === '') {
                        descriptionText = 'Exceptional property with premium features and finishes in a highly desirable location.';
                    }
                    
                    // Manejo de im√°genes
                    let imagesHTML = '';
                    let hasImages = false;
                    let imagesArray = [];
                    
                    if (property.imagenes && property.imagenes.length > 0) {
                        imagesArray = typeof property.imagenes === 'string' ? 
                            JSON.parse(property.imagenes) : property.imagenes;
                        hasImages = imagesArray.length > 0;
                        
                        imagesHTML = imagesArray.map((img, _idx) => `
                            <img src="${img}" class="property-detail-image ${_idx === 0 ? 'active' : ''}" alt="Property image">
                        `).join('');
                    }
                    
                    // Generar HTML de la p√°gina de detalles
                    const appContent = document.getElementById('app-content');
                    if (!appContent) {
                        console.error('‚ùå Elemento app-content no encontrado');
                        return;
                    }
                    console.log('üìù Generando HTML de detalles');
                    appContent.innerHTML = `
                        <div class="property-detail-container">
                            <a href="casas.html" class="back-button">‚Üê Back to Properties</a>
                            <div class="property-detail-card">
                                ${hasImages ? `
                                    <div class="detail-media">
                                        <div class="detail-hero">
                                            ${imagesHTML}
                                            <button class="detail-ctrl prev">‚Äπ</button>
                                            <button class="detail-ctrl next">‚Ä∫</button>
                                        </div>
                                        <div class="detail-thumbs">
                                            <div class="thumb-strip">
                                                ${imagesArray.map((img, i) => `
                                                    <div class="thumb ${i === 0 ? 'active' : ''}" data-index="${i}">
                                                        <img src="${img}" alt="thumb ${i+1}">
                                                    </div>`).join('')}
                                            </div>
                                            <span class="thumb-count">${imagesArray.length} Photos</span>
                                        </div>
                                    </div>
                                ` : '<div class="no-image" style="padding: 40px; text-align: center;">No images available</div>'}
                                
                        <div class="property-detail-info">
                            <h1 class="property-detail-title">${title}</h1>
                            <div class="property-location">${location}</div>
                            <p class="property-detail-description">${descriptionText.replace(/\n/g, '<br>')}</p>
                            <div class="bottom-row" style="margin-top: 16px;">
                                <div class="property-detail-price" style="margin:0;">${price}</div>
                            </div>
                                    
                                    <div class="overview-section">
                                        <div class="overview-title">Overview</div>
                                        <div class="overview-grid">
                                            <div class="overview-group">
                                                <h4>Details</h4>
                                                <div class="overview-row"><span class="overview-key">Bedrooms</span><span class="overview-val">${property.habitaciones || '3'}</span></div>
                                                <div class="overview-row"><span class="overview-key">Bathrooms</span><span class="overview-val">${property.ba√±os || '2'}</span></div>
                                                <div class="overview-row"><span class="overview-key">Guest Toilets</span><span class="overview-val">${property.aseos || '1'}</span></div>
                                            </div>
                                            <div class="overview-group">
                                                <h4>Measurements</h4>
                                                <div class="overview-row"><span class="overview-key">Total m¬≤</span><span class="overview-val">${property.tama√±o || '‚Äî'}</span></div>
                                                <div class="overview-row"><span class="overview-key">Built m¬≤</span><span class="overview-val">${property.construido || '‚Äî'}</span></div>
                                                <div class="overview-row"><span class="overview-key">Terraces m¬≤</span><span class="overview-val">${property.terraza || '‚Äî'}</span></div>
                                            </div>
                                            <div class="overview-group">
                                                <h4>Features</h4>
                                                <div class="overview-row"><span class="overview-key">Piscina</span><span class="overview-val">${property.piscina === true || property.piscina === 'true' ? '‚úì' : '‚úó'}</span></div>
                                                <div class="overview-row"><span class="overview-key">Jard√≠n</span><span class="overview-val">${property.jardin === true || property.jardin === 'true' ? '‚úì' : '‚úó'}</span></div>
                                            </div>
                                        </div>
                                    </div>
                                    <div id="property-map"></div>
                                    <div class="map-legend" id="map-legend"></div>
                                </div>
                            </div>
                        </div>
                    `;
                    
                    // Agregar funcionalidad para hacer clic en las im√°genes
                    if (hasImages) {
                        console.log('üñºÔ∏è Inicializando carrusel de im√°genes');
                        initDetailMediaCarousel();
                    }
                    console.log('‚úÖ P√°gina de detalles generada correctamente');
                    // Render map below features - wait for Google Maps to load
                    if (typeof google !== 'undefined' && google.maps) {
                        console.log('üó∫Ô∏è Google Maps disponible, renderizando mapa...');
                        renderPropertyMap({
                            address: property.ubi || '',
                            lat: property.lat,
                            lng: property.lng,
                            title: title
                        });
                    } else {
                        console.log('‚è≥ Google Maps no disponible a√∫n, esperando...');
                        // Wait for Google Maps to load
                        const checkGoogleMaps = () => {
                            if (typeof google !== 'undefined' && google.maps) {
                                console.log('üó∫Ô∏è Google Maps cargado, renderizando mapa...');
                                renderPropertyMap({
                                    address: property.ubi || '',
                                    lat: property.lat,
                                    lng: property.lng,
                                    title: title
                                });
                            } else {
                                console.log('‚è≥ Esperando Google Maps...');
                                setTimeout(checkGoogleMaps, 100);
                            }
                        };
                        checkGoogleMaps();
                    }
                })
                .catch(error => {
                    console.error('‚ùå Error loading property details:', error);
                    console.error('‚ùå Error type:', error.name);
                    console.error('‚ùå Error message:', error.message);
                    console.error('‚ùå Error stack:', error.stack);
                    
                    // Intentar usar datos locales como fallback
                    console.log('üîÑ Intentando usar datos locales como fallback...');
                    try {
                        // Verificar si hay datos en localStorage o en la p√°gina
                        const localData = window.allProperties || [];
                        console.log('üì¶ Datos locales encontrados:', localData.length);
                        
                        if (localData && localData.length > 0) {
                            const property = localData[propertyId];
                            if (property) {
                                console.log('‚úÖ Usando datos locales para mostrar detalles');
                                // Aqu√≠ podr√≠as llamar a una funci√≥n que renderice con datos locales
                                // Por ahora, mostrar error pero con informaci√≥n √∫til
                            }
                        }
                    } catch (localError) {
                        console.error('‚ùå Error con datos locales:', localError);
                    }
                    
                    const appContent = document.getElementById('app-content');
                    if (!appContent) {
                        console.error('‚ùå Elemento app-content no encontrado para mostrar error');
                        return;
                    }
                    
                    appContent.innerHTML = `
                        <div class="property-detail-container">
                            <a href="casas.html" class="back-button">‚Üê Back to Properties</a>
                            <div class="property-detail-card">
                                <div class="no-image" style="padding: 40px; text-align: center; color: #e74c3c;">
                                    <h3>Error loading property details</h3>
                                    <p><strong>Error:</strong> ${error.message}</p>
                                    <p><strong>API URL:</strong> ${API_BASE}/data</p>
                                    <p><strong>Property ID:</strong> ${propertyId}</p>
                                    <p><strong>Possible causes:</strong></p>
                                    <ul style="text-align: left; display: inline-block;">
                                        <li>Server not running on port 3000</li>
                                        <li>Nginx not proxying /api/ correctly</li>
                                        <li>CORS issues</li>
                                        <li>Database connection problems</li>
                                    </ul>
                                    <small>Please check the console for more details or try again later</small>
                                </div>
                            </div>
                        </div>
                    `;
                });
            }
        });

        // L√≥gica para ajustar la posici√≥n del panel de filtros al hacer scroll (solo desktop)
        function handleFiltersScroll() {
            const filtersPanel = document.getElementById('filters-panel');
            const header = document.querySelector('header');
            
            if (!filtersPanel || !header) {
                return;
            }
            
            // No aplicar en m√≥vil (ancho <= 767px) ni en m√≥vil horizontal (ancho <= 1024px y landscape)
            const isMobile = window.innerWidth <= 767;
            const isMobileLandscape = window.innerWidth <= 1024 && window.matchMedia('(orientation: landscape)').matches;
            
            if (isMobile || isMobileLandscape) {
                // Limpiar estilos inline en m√≥vil para que funcionen los estilos CSS
                filtersPanel.style.top = '';
                filtersPanel.style.height = '';
                filtersPanel.style.position = '';
                return;
            }
            
            // Colocar el panel justo debajo del header visible.
            // Si el header est√° fuera de pantalla (scroll hacia abajo), su bottom ser√° <= 0 y el panel quedar√° pegado al top (0).
            const headerRect = header.getBoundingClientRect();
            const headerBottom = Math.max(0, Math.round(headerRect.bottom));
            
            filtersPanel.style.top = headerBottom + 'px';
            filtersPanel.style.height = (window.innerHeight - headerBottom) + 'px';
        }

        // Funci√≥n de prueba para verificar que el scroll funciona
        function testScrollFunction() {
            console.log('=== PRUEBA DE SCROLL ===');
            console.log('Ancho de ventana:', window.innerWidth);
            console.log('Panel encontrado:', !!document.getElementById('filters-panel'));
            console.log('Header encontrado:', !!document.querySelector('header'));
            handleFiltersScroll();
        }
        
        // Agregar el event listener para el scroll
        window.addEventListener('scroll', function() {
            // Limpiar estilos inline en m√≥vil horizontal antes de aplicar cualquier l√≥gica
            const isMobileLandscape = window.innerWidth <= 1024 && window.matchMedia('(orientation: landscape)').matches;
            if (isMobileLandscape) {
                const filtersPanel = document.getElementById('filters-panel');
                if (filtersPanel) {
                    filtersPanel.style.top = '';
                    filtersPanel.style.height = '';
                    filtersPanel.style.position = '';
                }
            }
            handleFiltersScroll();
        });
        
        // Funci√≥n de prueba disponible globalmente
        window.testScroll = testScrollFunction;
        
        // Evitar que el teclado cierre los filtros en m√≥vil: solo reaccionar a cambios de ancho
        let lastResizeInnerWidth = window.innerWidth;
        window.addEventListener('resize', function() {
            const filtersPanel = document.getElementById('filters-panel');
            const filtersContent = document.getElementById('filters-content');
            const toggleIcon = document.getElementById('toggle-icon');
            const isMobile = window.innerWidth <= 767;
            const widthChanged = window.innerWidth !== lastResizeInnerWidth;
            lastResizeInnerWidth = window.innerWidth;
            
            // Si estamos en m√≥vil y solo cambi√≥ la altura (apertura del teclado), no colapsar
            if (isMobile && !widthChanged) {
                // Si adem√°s el foco est√° en un control dentro de los filtros, mantenerlos abiertos
                const ae = document.activeElement;
                const isTypingInFilters = ae && (ae.tagName === 'INPUT' || ae.tagName === 'TEXTAREA' || ae.tagName === 'SELECT') && ae.closest('#filters-panel');
                if (isTypingInFilters) {
                    if (filtersContent) filtersContent.classList.add('show');
                    if (toggleIcon) toggleIcon.textContent = '‚ñ≤';
                }
                return;
            }
            
            const isMobileLandscape = window.innerWidth <= 1024 && window.matchMedia('(orientation: landscape)').matches;
            
            if (isMobile || isMobileLandscape) {
                // En m√≥vil o m√≥vil horizontal, resetear estilos inline para que funcionen los CSS
                if (filtersPanel) {
                    filtersPanel.style.top = '';
                    filtersPanel.style.height = '';
                    filtersPanel.style.position = '';
                }
                if (filtersContent) filtersContent.classList.remove('show');
                if (toggleIcon) toggleIcon.textContent = '‚ñº';
            } else {
                // En desktop, resetear estilos y aplicar l√≥gica de scroll
                if (filtersPanel) {
                    filtersPanel.style.top = '';
                    filtersPanel.style.height = '';
                }
                if (filtersContent) filtersContent.classList.remove('show');
                if (toggleIcon) toggleIcon.textContent = '‚ñº';
                handleFiltersScroll();
            }
        });

        // En m√≥vil, al enfocar cualquier input dentro de filtros, forzar apertura del desplegable
        document.addEventListener('focusin', function(ev) {
            if (window.innerWidth > 767) return;
            const target = ev.target;
            if (!target) return;
            if (target.closest && target.closest('#filters-panel')) {
                const filtersContent = document.getElementById('filters-content');
                const toggleIcon = document.getElementById('toggle-icon');
                if (filtersContent) filtersContent.classList.add('show');
                if (toggleIcon) toggleIcon.textContent = '‚ñ≤';
            }
        });
        
        // Funci√≥n de inicializaci√≥n
        function initScrollFunctionality() {
            console.log('Inicializando funcionalidad de scroll');
            handleFiltersScroll();
        }
        
        // Ejecutar una vez al cargar para establecer la posici√≥n inicial
        document.addEventListener('DOMContentLoaded', initScrollFunctionality);
        
        // Tambi√©n ejecutar cuando la ventana est√© completamente cargada
        window.addEventListener('load', initScrollFunctionality);
    </script>
    <script>
        // Render a marker for the property (Maps is loaded statically)
        async function renderPropertyMap(opts) {
            console.log('üó∫Ô∏è Iniciando renderPropertyMap con:', opts);
            
            // Verificar que Google Maps est√© disponible
            if (typeof google === 'undefined' || !google.maps) {
                console.error('‚ùå Google Maps no est√° disponible');
                const mapEl = document.getElementById('property-map');
                if (mapEl) {
                    mapEl.innerHTML = '<div style="padding: 20px; text-align: center; color: #666;">Map not available - Google Maps not loaded</div>';
                }
                return;
            }

            const mapEl = document.getElementById('property-map');
            if (!mapEl) {
                console.error('‚ùå Elemento property-map no encontrado');
                return;
            }
            
            console.log('üó∫Ô∏è Elemento del mapa encontrado, inicializando...');

            const fallback = { lat: 43.2630, lng: -2.9350 }; // Bilbao
            const map = new google.maps.Map(mapEl, { center: fallback, zoom: 14 });

            const addMarker = (pos, titleText) => {
                const marker = new google.maps.Marker({ position: pos, map, title: titleText || opts.title || 'Property' });
                if (titleText) {
                    const info = new google.maps.InfoWindow({ content: `<strong>${titleText}</strong>` });
                    info.open({ map, anchor: marker });
                }
                return marker;
            };

            // --- Same category icon set as in pois.html ---
            const ICONS = {
                sanidad: 'data:image/svg+xml;charset=UTF-8,' + encodeURIComponent(`<svg xmlns="http://www.w3.org/2000/svg" width="48" height="48" viewBox="0 0 48 48"><g fill="none" fill-rule="evenodd"><path d="M24 3c-9.94 0-18 8.06-18 18 0 12.21 15.08 22.16 17.02 23.41.6.39 1.36.39 1.96 0C26.92 43.16 42 33.21 42 21 42 11.06 33.94 3 24 3z" fill="#e74c3c"/><path d="M27 14h-6v7h-7v6h7v7h6v-7h7v-6h-7z" fill="#fff"/></g></svg>`),
                educacion: 'data:image/svg+xml;charset=UTF-8,' + encodeURIComponent(`<svg xmlns="http://www.w3.org/2000/svg" width="48" height="48" viewBox="0 0 48 48"><g fill="none" fill-rule="evenodd"><path d="M24 3c-9.94 0-18 8.06-18 18 0 12.21 15.08 22.16 17.02 23.41.6.39 1.36.39 1.96 0C26.92 43.16 42 33.21 42 21 42 11.06 33.94 3 24 3z" fill="#2e86de"/><path d="M24 13l14 6-14 6-14-6 14-6zm-9 9v5l9 4 9-4v-5l-9 4-9-4z" fill="#fff"/></g></svg>`),
                comida: 'data:image/svg+xml;charset=UTF-8,' + encodeURIComponent(`<svg xmlns="http://www.w3.org/2000/svg" width="48" height="48" viewBox="0 0 48 48"><g fill="none" fill-rule="evenodd"><path d="M24 3c-9.94 0-18 8.06-18 18 0 12.21 15.08 22.16 17.02 23.41.6.39 1.36.39 1.96 0C26.92 43.16 42 33.21 42 21 42 11.06 33.94 3 24 3z" fill="#27ae60"/><g stroke="#fff" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M15 22c0-4.4 4.8-7 9-7s9 2.6 9 7c0 0-1 4-9 4s-9-4-9-4z" fill="#fff" stroke="none"/><path d="M30 17l4 4"/><path d="M34 17l-4 4"/><path d="M32 15l-6 6"/><path d="M20 17c.8-1.4 2.7-2 4-2"/></g></g></svg>`),
                transporte: 'data:image/svg+xml;charset=UTF-8,' + encodeURIComponent(`<svg xmlns="http://www.w3.org/2000/svg" width="48" height="48" viewBox="0 0 48 48"><g fill="none" fill-rule="evenodd"><path d="M24 3c-9.94 0-18 8.06-18 18 0 12.21 15.08 22.16 17.02 23.41.6.39 1.36.39 1.96 0C26.92 43.16 42 33.21 42 21 42 11.06 33.94 3 24 3z" fill="#8e44ad"/><path d="M16 16c0-2.21 1.79-4 4-4h8c2.21 0 4 1.79 4 4v9c0 1.66-1.34 3-3 3h-10c-1.66 0-3-1.34-3-3v-9zm2 1h12v6H18v-6zm0 9h2v2h-2v-2zm10 0h2v2h-2v-2z" fill="#fff"/></g></svg>`)
            };
            const iconFor = (type) => ({ url: ICONS[type] || ICONS.transporte, scaledSize: new google.maps.Size(36, 36), anchor: new google.maps.Point(18, 34) });
            function renderLegend() {
                const legend = document.getElementById('map-legend');
                if (!legend) return;
                const entries = [
                    { key: 'sanidad', label: 'Health' },
                    { key: 'educacion', label: 'Education' },
                    { key: 'comida', label: 'Food' },
                    { key: 'transporte', label: 'Transport' }
                ];
                legend.innerHTML = entries.map(e => `
                    <span class="legend-item">
                        <img src="${ICONS[e.key]}" alt="${e.label}"> ${e.label}
                    </span>
                `).join('');
            }

            // Buscar 3-4 POIs cercanos por categor√≠a usando Places
            function addNearbyPOIs(map, center) {
                if (!google.maps.places || !google.maps.places.PlacesService) {
                    return; // Places library not loaded; skip POIs to avoid crashing
                }
                const service = new google.maps.places.PlacesService(map);
                const categories = [
                    { key: 'sanidad', types: ['hospital'] },
                    { key: 'educacion', types: ['school'] },
                    { key: 'comida', types: ['supermarket', 'grocery_or_supermarket'] },
                    { key: 'transporte', types: ['transit_station', 'bus_station', 'train_station', 'subway_station'] }
                ];

                categories.forEach(cat => {
                    let collected = 0;
                    const maxResults = 4;
                    const seen = new Set();
                    const doSearch = (placeType) => new Promise(resolve => {
                        service.nearbySearch({ location: center, radius: 3000, type: placeType }, (results, status) => {
                            if (status === google.maps.places.PlacesServiceStatus.OK && results) {
                                for (const r of results) {
                                    if (collected >= maxResults) break;
                                    if (seen.has(r.place_id)) continue;
                                    seen.add(r.place_id);
                                    const pos = r.geometry && r.geometry.location;
                                    if (!pos) continue;
                                    new google.maps.Marker({ position: pos, map, title: r.name, icon: iconFor(cat.key) });
                                    collected++;
                                }
                            }
                            resolve();
                        });
                    });
                    // encadenar b√∫squedas por los tipos listados hasta alcanzar 3-4
                    (async () => {
                        for (const t of cat.types) {
                            if (collected >= maxResults) break;
                            await doSearch(t);
                        }
                    })();
                });
            }

            if (typeof opts.lat === 'number' && typeof opts.lng === 'number') {
                const pos = { lat: opts.lat, lng: opts.lng };
                map.setCenter(pos);
                const cityTitle = (opts.address || '').split(',')[0].trim() || opts.address || 'Location';
                addMarker(pos, cityTitle);
                addNearbyPOIs(map, pos);
                renderLegend();
            } else if (opts.address) {
                const geocoder = new google.maps.Geocoder();
                const cityQuery = (opts.address.split(',')[0] || opts.address).trim();
                console.log('[Map] Geocoding city:', cityQuery, 'from address:', opts.address);
                const tryGeocode = (query, label) => new Promise(resolve => {
                    geocoder.geocode({ address: query, region: 'ES' }, (results, status) => {
                        console.log('[Map] Geocode status', status, 'for', query);
                        if (status === 'OK' && results && results[0]) {
                            const pos = results[0].geometry.location;
                            map.setCenter(pos);
                            addMarker(pos, label || query);
                            addNearbyPOIs(map, pos);
                            renderLegend();
                            resolve(true);
                        } else {
                            resolve(false);
                        }
                    });
                });

                // Secuencia de intentos: ciudad -> direcci√≥n completa -> ciudad + pa√≠s
                tryGeocode(cityQuery, cityQuery)
                    .then(ok => ok ? true : tryGeocode(opts.address, cityQuery))
                    .then(ok => ok ? true : tryGeocode(`${cityQuery}, Espa√±a`, cityQuery))
                    .catch(() => {});
            }
        }
        // Initialize detail media carousel and thumbnails
        function initDetailMediaCarousel() {
            const hero = document.querySelector('.detail-hero');
            if (!hero) return;
            const slides = Array.from(hero.querySelectorAll('img'));
            const prev = hero.querySelector('.detail-ctrl.prev');
            const next = hero.querySelector('.detail-ctrl.next');
            const thumbs = Array.from(document.querySelectorAll('.thumb'));
            let index = slides.findIndex(img => img.classList.contains('active'));
            if (index < 0) index = 0;

            function show(i) {
                slides.forEach(s => s.classList.remove('active'));
                thumbs.forEach(t => t.classList.remove('active'));
                slides[i].classList.add('active');
                if (thumbs[i]) thumbs[i].classList.add('active');
                index = i;
            }

            function nextImg() { show((index + 1) % slides.length); }
            function prevImg() { show((index - 1 + slides.length) % slides.length); }

            if (next) next.addEventListener('click', nextImg);
            if (prev) prev.addEventListener('click', prevImg);
            thumbs.forEach(t => t.addEventListener('click', () => show(parseInt(t.dataset.index))));

            // Keyboard support
            document.addEventListener('keydown', (e) => {
                if (e.key === 'ArrowRight') nextImg();
                if (e.key === 'ArrowLeft') prevImg();
            });
        }
        
        // --- Estilos para el modal legal y cookie banner ---
        (function injectLegalStyles(){
            const css = `
            .legal-modal-backdrop{position:fixed;inset:0;background:rgba(0,0,0,.45);display:none;align-items:center;justify-content:center;z-index:1000;padding:16px}
            .legal-modal-backdrop[aria-hidden="false"]{display:flex}
            .legal-modal{background:#fff;border-radius:10px;max-width:820px;width:100%;max-height:85vh;overflow:auto;box-shadow:0 12px 40px rgba(0,0,0,.25);padding:20px}
            .legal-close{position:sticky;top:0;left:100%;transform:translateX(-100%);border:none;background:transparent;font-size:28px;cursor:pointer;color:#888}
            .legal-title{margin:4px 0 12px 0;color:var(--dark-turquoise)}
            .legal-tabs{display:flex;gap:8px;margin-bottom:12px;flex-wrap:wrap}
            .legal-tab{border:1px solid var(--medium-gray);background:var(--light-gray);padding:6px 10px;border-radius:8px;cursor:pointer;font-weight:600;color:var(--charcoal)}
            .legal-tab.active{background:var(--primary-turquoise);color:#fff;border-color:var(--dark-turquoise)}
            .legal-content{color:var(--text-gray);line-height:1.7}
            .legal-section h3{color:var(--dark-turquoise);margin:6px 0 8px}
            .cookie-banner{position:fixed;left:0;right:0;bottom:0;background:#fff;border-top:2px solid var(--medium-gray);box-shadow:0 -6px 20px rgba(0,0,0,.12);padding:12px 16px;display:flex;gap:12px;align-items:center;justify-content:space-between;z-index:1001}
            .cookie-text{font-size:.95em;color:var(--charcoal)}
            .cookie-actions{display:flex;gap:8px}
            .cookie-btn{background:var(--primary-turquoise);border:none;color:#fff;font-weight:700;border-radius:6px;padding:8px 12px;cursor:pointer}
            .cookie-link-btn{background:transparent;border:1px solid var(--primary-turquoise);color:var(--primary-turquoise);font-weight:700;border-radius:6px;padding:8px 12px;cursor:pointer}
            @media (max-width: 600px){.cookie-banner{flex-direction:column;align-items:flex-start}}
            `;
            const style = document.createElement('style');
            style.textContent = css;
            document.head.appendChild(style);
        })();
        
        // --- L√≥gica modal legal & cookies ---
        (function legalAndCookies(){
            const modal = document.getElementById('legalModal');
            const closeBtn = document.getElementById('legalClose');
            const tabs = Array.from(document.querySelectorAll('.legal-tab'));
            const sections = {
                aviso: document.getElementById('sec-aviso'),
                terminos: document.getElementById('sec-terminos'),
                cookies: document.getElementById('sec-cookies')
            };
            function openModal(section){
                Object.values(sections).forEach(s=> s.hidden = true);
                if(section && sections[section]) sections[section].hidden = false; else sections.aviso.hidden = false;
                tabs.forEach(t=> t.classList.toggle('active', t.getAttribute('data-target') === (section||'aviso')));
                modal.setAttribute('aria-hidden','false');
                document.body.style.overflow = 'hidden';
            }
            function closeModal(){
                modal.setAttribute('aria-hidden','true');
                document.body.style.overflow = '';
            }
            // Tabs internas
            tabs.forEach(btn=> btn.addEventListener('click', ()=> openModal(btn.getAttribute('data-target'))));
            // Cerrar
            closeBtn?.addEventListener('click', closeModal);
            modal?.addEventListener('click', (e)=>{ if(e.target === modal) closeModal(); });

            // Cookie banner: persistencia con localStorage + sincronizaci√≥n entre pesta√±as
            const banner = document.getElementById('cookieBanner');
            const accept = document.getElementById('cookieAccept');
            const more = document.getElementById('cookieMore');
            const cookieChannel = ('BroadcastChannel' in window) ? new BroadcastChannel('mbi_cookie_channel') : null;
            function hideCookie(){ banner.hidden = true; banner.style.display = 'none'; }
            function showCookieBannerIfNeeded(){
                try{
                    const consent = localStorage.getItem('cookies_accepted');
                    if(consent === 'true') {
                        banner.hidden = true;
                        banner.style.display = 'none';
                    } else {
                        banner.hidden = false;
                    }
                }catch(e){ 
                    banner.hidden = false; 
                }
            }
            function acceptCookies(){
                try{ 
                    localStorage.setItem('cookies_accepted', 'true');
                    cookieChannel?.postMessage({type:'mbi_cookie_accept'});
                    hideCookie();
                }catch(e){
                    console.error('Error saving cookie consent:', e);
                }
            }
            cookieChannel?.addEventListener('message', (e)=>{
                if(e?.data?.type === 'mbi_cookie_accept'){
                    try{ localStorage.setItem('cookies_accepted', 'true'); }catch(e){}
                    hideCookie();
            }
            });
            accept?.addEventListener('click', acceptCookies);
            more?.addEventListener('click', ()=> openModal('cookies'));
            // Footer link opens cookies section
            document.getElementById('footerLegalLink')?.addEventListener('click', (e)=>{ e.preventDefault(); openModal('cookies'); });
            // Verificar inmediatamente al cargar
            showCookieBannerIfNeeded();
            
            // Tambi√©n en DOMContentLoaded como respaldo
            document.addEventListener('DOMContentLoaded', showCookieBannerIfNeeded);
            
            // Verificar tambi√©n cuando la p√°gina se vuelve visible (cambio de pesta√±a)
            document.addEventListener('visibilitychange', function() {
                if (!document.hidden) {
                    showCookieBannerIfNeeded();
                }
            });
            // Exponer utilidad para otras p√°ginas si hiciera falta
            window.mbiOpenLegal = openModal;
        })();

        // Logo responsive: dividir a 3 palabras en la primera l√≠nea y resto centrado en m√≥vil
        (function responsiveLogo(){
            function apply(){
                document.querySelectorAll('.logo-text .logo-main').forEach(function(el){
                    var isMobile = window.innerWidth <= 767;
                    var original = el.getAttribute('data-original');
                    if(!original){ original = (el.textContent||'').trim().replace(/\s+/g,' '); el.setAttribute('data-original', original); }
                    if(isMobile){
                        var words = original.split(' ');
                        var firstLine = words.slice(0, 3).join(' ');
                        var secondLine = words.slice(3).join(' ');
                        el.innerHTML = '<span class="logo-chunk" style="display:block; text-align:left; white-space:nowrap;">' + firstLine + '</span>' +
                                       (secondLine ? '<span class="logo-chunk last" style="display:block; text-align:center; white-space:nowrap;">' + secondLine + '</span>' : '');
                    } else {
                        el.textContent = original;
                    }
                });
            }
            apply();
            window.addEventListener('resize', apply);
        })();
    </script>
    <!-- Cargar Google Maps de forma as√≠ncrona usando el m√©todo recomendado por Google -->
    <script>
        (function() {
            // Definir el callback antes de cargar el script
            window.initGoogleMaps = function() {
                console.log('‚úÖ Google Maps cargado correctamente');
                // Re-inicializar b√∫squeda de ubicaci√≥n si existe
                if (typeof initLocationSearch === 'function') {
                    setTimeout(initLocationSearch, 100);
                }
                // Inicializar mapas si existen
                if (typeof renderPropertyMap === 'function') {
                    // Los mapas se inicializar√°n cuando se necesiten
                }
            };
            
            // Cargar el script de forma as√≠ncrona
            const script = document.createElement('script');
            // No usar loading=async en la URL cuando se usa callback, el script ya es as√≠ncrono
            script.src = 'https://maps.googleapis.com/maps/api/js?key=AIzaSyD5aaBvxYkF_-T0SdvJCK3FDwuzvIeBVC0&libraries=places&callback=initGoogleMaps';
            script.async = true;
            script.defer = true;
            
            // Agregar el script al head
            document.head.appendChild(script);
        })();
    </script>

</body>
</html>



